<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Photo2Value</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body, #root { height: 100%; width: 100%; overflow: hidden; }
  body {
    font-family: 'DM Sans', system-ui, sans-serif;
    background: #06060b;
    -webkit-font-smoothing: antialiased;
  }
  h1,h2,h3,h4,h5,h6 { font-family: 'Sora', system-ui, sans-serif; }
  input, select { font-family: 'DM Sans', system-ui, sans-serif; }
  .form-input:focus { border-color: rgba(212,168,83,0.5) !important; outline: none; }

  @keyframes slideUp { from { opacity:0; transform:translateY(24px); } to { opacity:1; transform:translateY(0); } }
  @keyframes slideRight { from { opacity:0; transform:translateX(-24px); } to { opacity:1; transform:translateX(0); } }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
  @keyframes scanLine { 0%,100% { top:8%; } 50% { top:88%; } }
  @keyframes pulse { 0%,100% { opacity:0.4; } 50% { opacity:0.8; } }
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes spinReverse { to { transform: rotate(-360deg); } }
  @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

  .anim-up { animation: slideUp 0.5s ease-out both; }
  .anim-right { animation: slideRight 0.5s ease-out both; }
  .anim-fade { animation: fadeIn 0.4s ease-out both; }

  .scroll-hide::-webkit-scrollbar { display: none; }
  .scroll-hide { -ms-overflow-style: none; scrollbar-width: none; }

  .glass { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(16px); }
  .glass-hover:hover { background: rgba(255,255,255,0.08); }

  .gradient-amber { background: linear-gradient(135deg, #d4a853, #b8860b); }
  .gradient-dark { background: linear-gradient(180deg, #0a0a0f 0%, #0d0d14 50%, #0a0a0f 100%); }

  .text-gold { color: #d4a853; }
  .text-muted { color: #64748b; }
  .text-dim { color: #475569; }
  .bg-gold { background-color: #d4a853; }

  .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

  select option { background: #1e293b; color: white; }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

/* ‚îÄ‚îÄ Inline SVG Icons ‚îÄ‚îÄ */
const Icon = ({d, size=20, color="currentColor", strokeWidth=2}) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round">
    <path d={d}/>
  </svg>
);

const Icons = {
  Home: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
  Camera: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>,
  Search: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
  Bell: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>,
  User: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
  ArrowLeft: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
  Grid: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
  List: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
  TrendUp: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
  TrendDown: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
  ChevronRight: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
  Plus: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  Upload: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0018 9h-1.26A8 8 0 103 16.3"/></svg>,
  Filter: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
  Shield: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
  Download: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
  Help: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
  LogOut: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  Share: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>,
  Refresh: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>,
  Edit: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>,
  Zap: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
  Package: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
  Dollar: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>,
  BarChart: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
  Clock: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
  Info: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
  Trash2: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
  AlertTriangle: ({size=20,color="currentColor"}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
};

/* ‚îÄ‚îÄ Data ‚îÄ‚îÄ */
const priceHistory = [
  {m:'Sep',v:1270},{m:'Oct',v:1285},{m:'Nov',v:1310},{m:'Dec',v:1350},{m:'Jan',v:1385},{m:'Feb',v:1420}
];


/* ‚îÄ‚îÄ Mini Chart Component ‚îÄ‚îÄ */
const PriceChart = ({ data, width=320, height=160 }) => {
  const vals = data.map(d => d.v);
  const min = Math.min(...vals) - 20;
  const max = Math.max(...vals) + 20;
  const range = max - min;
  const pad = { top:12, right:12, bottom:28, left:48 };
  const cw = width - pad.left - pad.right;
  const ch = height - pad.top - pad.bottom;

  const pts = data.map((d, i) => ({
    x: pad.left + (i / (data.length - 1)) * cw,
    y: pad.top + ch - ((d.v - min) / range) * ch,
  }));

  const linePath = pts.map((p,i) => `${i===0?'M':'L'}${p.x},${p.y}`).join(' ');
  const areaPath = linePath + ` L${pts[pts.length-1].x},${pad.top+ch} L${pts[0].x},${pad.top+ch} Z`;

  return (
    <svg width="100%" viewBox={`0 0 ${width} ${height}`} style={{display:'block'}}>
      <defs>
        <linearGradient id="areaGrad" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stopColor="#d4a853" stopOpacity="0.3"/>
          <stop offset="100%" stopColor="#d4a853" stopOpacity="0"/>
        </linearGradient>
      </defs>
      {/* Grid lines */}
      {[0,0.25,0.5,0.75,1].map((pct,i) => {
        const y = pad.top + ch * (1 - pct);
        const val = Math.round(min + range * pct);
        return <g key={i}>
          <line x1={pad.left} y1={y} x2={width-pad.right} y2={y} stroke="rgba(255,255,255,0.06)" strokeWidth="1"/>
          <text x={pad.left-8} y={y+4} fill="#64748b" fontSize="10" textAnchor="end" fontFamily="DM Sans">${val}</text>
        </g>;
      })}
      {/* X labels */}
      {data.map((d,i) => (
        <text key={i} x={pts[i].x} y={height-6} fill="#64748b" fontSize="10" textAnchor="middle" fontFamily="DM Sans">{d.m}</text>
      ))}
      {/* Area + Line */}
      <path d={areaPath} fill="url(#areaGrad)"/>
      <path d={linePath} fill="none" stroke="#d4a853" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
      {/* Dots */}
      {pts.map((p,i) => <circle key={i} cx={p.x} cy={p.y} r="4" fill="#0a0a0f" stroke="#d4a853" strokeWidth="2"/>)}
    </svg>
  );
};

/* ‚îÄ‚îÄ Stable components (defined outside App to prevent unmount/remount on re-render) ‚îÄ‚îÄ */
const InfoTip = ({text, align}) => {
  const [show, setShow] = useState(false);
  const ref = React.useRef(null);
  const [pos, setPos] = useState('center');
  React.useEffect(() => {
    if (show && ref.current) {
      const rect = ref.current.getBoundingClientRect();
      if (rect.right + 90 > window.innerWidth) setPos('right');
      else if (rect.left - 90 < 0) setPos('left');
      else setPos('center');
    }
  }, [show]);
  const tipPos = align || pos;
  const tipStyle = tipPos === 'right'
    ? {right:0, transform:'none'}
    : tipPos === 'left'
    ? {left:0, transform:'none'}
    : {left:'50%', transform:'translateX(-50%)'};
  const arrowStyle = tipPos === 'right'
    ? {right:12, transform:'rotate(45deg)'}
    : tipPos === 'left'
    ? {left:12, transform:'rotate(45deg)'}
    : {left:'50%', transform:'translateX(-50%) rotate(45deg)'};
  return (
    <div ref={ref} style={{position:'relative',display:'inline-flex',marginLeft:6}} onMouseEnter={() => setShow(true)} onMouseLeave={() => setShow(false)} onClick={(e) => {e.stopPropagation();setShow(!show);}}>
      <Icons.Info size={14} color="#64748b"/>
      {show && (
        <div className="anim-fade" style={{position:'absolute',bottom:'calc(100% + 8px)',...tipStyle,background:'#1e293b',border:'1px solid rgba(255,255,255,0.15)',borderRadius:10,padding:'10px 14px',fontSize:12,color:'#cbd5e1',whiteSpace:'normal',width:180,zIndex:50,boxShadow:'0 8px 24px rgba(0,0,0,0.5)',lineHeight:1.5,fontFamily:'DM Sans, sans-serif'}}>
          {text}
          <div style={{position:'absolute',bottom:-5,...arrowStyle,width:10,height:10,background:'#1e293b',borderRight:'1px solid rgba(255,255,255,0.15)',borderBottom:'1px solid rgba(255,255,255,0.15)'}}/>
        </div>
      )}
    </div>
  );
};

const FormField = ({label, required, children, tip}) => (
  <div style={{marginBottom:16}}>
    <div style={{display:'flex',alignItems:'center',marginBottom:6}}>
      <label style={{fontSize:12,fontWeight:600,color:'#94a3b8',textTransform:'uppercase',letterSpacing:0.5}}>{label}{required && <span style={{color:'#d4a853'}}> *</span>}</label>
      {tip && <InfoTip text={tip}/>}
    </div>
    {children}
  </div>
);

/* ‚îÄ‚îÄ Main App ‚îÄ‚îÄ */
const App = () => {
  // Load from localStorage (start fresh with empty inventory)
  const loadItems = () => {
    try {
      const saved = localStorage.getItem('item2value_items');
      if (saved) return JSON.parse(saved);
      return [];
    } catch(e) { return []; }
  };

  const loadProfile = () => {
    try {
      const saved = localStorage.getItem('item2value_profile');
      if (saved) return JSON.parse(saved);
      return null;
    } catch(e) { return null; }
  };

  const [profile, setProfile] = useState(loadProfile);
  const [items, setItems] = useState(loadItems);
  const [screen, setScreen] = useState(loadProfile() ? 'home' : 'setup');
  const [editingProfile, setEditingProfile] = useState(false);
  const profileNameRef = useRef(null);
  const profileEmailRef = useRef(null);
  const [selectedId, setSelectedId] = useState(null);
  const [photoIndex, setPhotoIndex] = useState(0);
  const [viewMode, setViewMode] = useState('grid');
  const [filter, setFilter] = useState('All');
  const [search, setSearch] = useState('');
  const [sortBy, setSortBy] = useState('value-high');
  const [scanning, setScanning] = useState(false);
  const [analyzing, setAnalyzing] = useState(false);
  const [aiDone, setAiDone] = useState(false);
  const [editingCost, setEditingCost] = useState(false);
  const [editingAsking, setEditingAsking] = useState(false);
  const [editingMarket, setEditingMarket] = useState(false);
  const [editingEarnings, setEditingEarnings] = useState(false);
  const [costInput, setCostInput] = useState('');
  const [askingInput, setAskingInput] = useState('');
  const [marketInput, setMarketInput] = useState('');
  const [earningsInput, setEarningsInput] = useState('');
  const [editFormUI, setEditFormUI] = useState({category:'Fashion',condition:'Good',emoji:'üì¶',photos:[]});
  const editRefs = {
    name: useRef(null),
    brand: useRef(null),
    model: useRef(null),
    notes: useRef(null),
  };
  const [soldFilter, setSoldFilter] = useState('All');
  const [soldSearch, setSoldSearch] = useState('');
  const [soldSort, setSoldSort] = useState('recent');
  const [addingComp, setAddingComp] = useState(false);
  const [editingCompId, setEditingCompId] = useState(null);
  const [compForm, setCompForm] = useState({title:'',url:'',price:'',source:'eBay',condition:'Good'});
  const updateCompForm = (key, val) => setCompForm(prev => ({...prev, [key]: val}));
  const [showClearConfirm, setShowClearConfirm] = useState(false);
  const scrollRef = useRef(null);

  // Save to localStorage whenever items or profile change (with overflow protection)
  useEffect(() => {
    try {
      localStorage.setItem('item2value_items', JSON.stringify(items));
    } catch(e) {
      alert('Storage is almost full! Your latest change may not have saved. Go to Profile > Export Backup to save your data, then try removing some photos.');
    }
  }, [items]);
  useEffect(() => {
    if (profile) localStorage.setItem('item2value_profile', JSON.stringify(profile));
  }, [profile]);

  // Record a price history snapshot (dedupes same-day entries)
  const recordPriceSnapshot = (itemId, value) => {
    const today = new Date().toISOString().slice(0,10);
    setItems(prev => prev.map(it => {
      if (it.id !== itemId) return it;
      const history = it.priceHistory || [];
      // If there's already a snapshot today, update it instead of adding duplicate
      const existing = history.findIndex(h => h.date === today);
      if (existing >= 0) {
        const updated = [...history];
        updated[existing] = {...updated[existing], value, cost: it.cost, asking: it.asking};
        return {...it, priceHistory: updated};
      }
      return {...it, priceHistory: [...history, {date: today, value, cost: it.cost, asking: it.asking}]};
    }));
  };

  // Auto-update market value from comps (average of all comp prices)
  const recalcMarketFromComps = (itemId) => {
    setItems(prev => prev.map(it => {
      if (it.id !== itemId) return it;
      const comps = it.comps || [];
      const prices = comps.map(c => c.price).filter(p => p > 0);
      if (prices.length === 0) return it;
      const avg = Math.round(prices.reduce((s,p) => s+p, 0) / prices.length);
      // Also record price history snapshot
      const today = new Date().toISOString().slice(0,10);
      const history = it.priceHistory || [];
      const existing = history.findIndex(h => h.date === today);
      let newHistory;
      if (existing >= 0) {
        newHistory = [...history];
        newHistory[existing] = {...newHistory[existing], value: avg, cost: it.cost, asking: it.asking};
      } else {
        newHistory = [...history, {date: today, value: avg, cost: it.cost, asking: it.asking}];
      }
      return {...it, value: avg, priceHistory: newHistory};
    }));
  };

  const getItemCost = (item) => item.cost;
  const getItemAsking = (item) => item.asking;
  const getItemGain = (item) => {
    const cost = getItemCost(item);
    if (cost === 0) return 0;
    return Math.round(((item.value - cost) / cost) * 100);
  };

  const getComps = (itemId) => {
    const item = items.find(i => i.id === itemId);
    return item ? (item.comps || []) : [];
  };

  const totalValue = items.reduce((s,i) => s + i.value, 0);
  const avgValue = items.length > 0 ? Math.round(totalValue / items.length) : 0;
  const topGainer = items.length > 0 ? items.reduce((m,i) => getItemGain(i) > getItemGain(m) ? i : m) : null;
  const soldItems = items.filter(i => i.earnings && i.earnings > 0);
  const totalEarnings = soldItems.reduce((s,i) => s + i.earnings, 0);
  const selected = items.find(i => i.id === selectedId);

  const filtered = items
    .filter(i => (filter === 'All' || i.category === filter) && i.name.toLowerCase().includes(search.toLowerCase()))
    .sort((a,b) => {
      if (sortBy === 'value-high') return b.value - a.value;
      if (sortBy === 'value-low') return a.value - b.value;
      if (sortBy === 'gain') return getItemGain(b) - getItemGain(a);
      return 0;
    });

  const goItem = (id) => { setSelectedId(id); setPhotoIndex(0); setScreen('detail'); };
  const takePhoto = () => {
    setScanning(true);
    setTimeout(() => { setScanning(false); setAnalyzing(true);
      setTimeout(() => { setAnalyzing(false); setAiDone(true); }, 2200);
    }, 900);
  };

  const fmt = (n) => '$' + n.toLocaleString();

  // Compress photo to prevent localStorage overflow (~50KB per photo instead of ~3MB)
  const compressPhoto = (dataUrl) => {
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        const maxSize = 600;
        let w = img.width, h = img.height;
        if (w > h && w > maxSize) { h = Math.round(h * maxSize / w); w = maxSize; }
        else if (h > maxSize) { w = Math.round(w * maxSize / h); h = maxSize; }
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, w, h);
        resolve(canvas.toDataURL('image/jpeg', 0.6));
      };
      img.onerror = () => resolve(dataUrl);
      img.src = dataUrl;
    });
  };
  const userName = profile ? profile.name : 'there';
  const userEmail = profile ? profile.email : '';
  const userInitial = userName.charAt(0).toUpperCase();
  const getGreeting = () => {
    const h = new Date().getHours();
    if (h < 12) return 'Good Morning';
    if (h < 17) return 'Good Afternoon';
    return 'Good Evening';
  };

  // Generate real alerts from actual inventory data
  const generateAlerts = () => {
    const a = [];
    let id = 1;
    const now = new Date();
    items.forEach(item => {
      const cost = getItemCost(item);
      const gain = getItemGain(item);
      const asking = getItemAsking(item);
      // Alert: item is worth more than you paid (positive ROI)
      if (gain > 15) {
        a.push({id: id++, type:'Strong Performer', msg:`${item.name} is up ${gain}% from what you paid.`, iconKey:'TrendUp', emoji:item.emoji, itemId:item.id});
      }
      // Alert: item value is below what you paid (losing money)
      if (item.value < cost && cost > 0) {
        const loss = Math.round(((cost - item.value) / cost) * 100);
        a.push({id: id++, type:'Below Cost', msg:`${item.name} market value is ${loss}% below what you paid.`, iconKey:'TrendDown', emoji:item.emoji, itemId:item.id});
      }
      // Alert: asking price is way above market (may be overpriced)
      if (asking > 0 && item.value > 0 && asking > item.value * 1.2) {
        const pct = Math.round(((asking - item.value) / item.value) * 100);
        a.push({id: id++, type:'Priced High', msg:`${item.name} asking is ${pct}% above market. May be hard to sell.`, iconKey:'Zap', emoji:item.emoji, itemId:item.id});
      }
      // Alert: asking price is below market (could get more)
      if (asking > 0 && item.value > 0 && asking < item.value * 0.9) {
        a.push({id: id++, type:'Underpriced', msg:`${item.name} is listed below market value. You could ask for more.`, iconKey:'Dollar', emoji:item.emoji, itemId:item.id});
      }
      // Alert: no comps added yet
      if (!item.comps || item.comps.length === 0) {
        a.push({id: id++, type:'Needs Comps', msg:`${item.name} has no comparable listings. Add comps for better valuation.`, iconKey:'Search', emoji:item.emoji, itemId:item.id});
      }
      // Alert: no market value set (defaulted to cost or asking)
      if (item.value === cost && asking !== cost) {
        a.push({id: id++, type:'Set Market Value', msg:`${item.name} market value may need updating. It's still set to your cost.`, iconKey:'Edit', emoji:item.emoji, itemId:item.id});
      }
      // Alert: item added recently (welcome)
      if (item.createdAt) {
        const created = new Date(item.createdAt);
        const hoursSince = (now - created) / (1000 * 60 * 60);
        if (hoursSince < 24) {
          a.push({id: id++, type:'New Item Added', msg:`${item.name} was added to your inventory.`, iconKey:'Package', emoji:item.emoji, itemId:item.id});
        }
      }
    });
    // Sort: actionable alerts first (Below Cost, Underpriced, Needs Comps), then info
    const priority = {'Below Cost':0,'Underpriced':1,'Priced High':2,'Needs Comps':3,'Set Market Value':4,'Strong Performer':5,'New Item Added':6};
    a.sort((x,y) => (priority[x.type]??99) - (priority[y.type]??99));
    return a;
  };
  const alerts = generateAlerts();
  const inputStyle = {width:'100%',background:'rgba(255,255,255,0.04)',border:'1px solid rgba(255,255,255,0.1)',borderRadius:10,padding:'12px 14px',color:'#fff',fontSize:14,outline:'none',fontFamily:'DM Sans, sans-serif'};
  // Focus styles handled via CSS .form-input:focus class

  const GainBadge = ({gain, size='sm'}) => {
    const isUp = gain >= 0;
    const Ic = isUp ? Icons.TrendUp : Icons.TrendDown;
    const color = isUp ? '#4ade80' : '#f87171';
    const sz = size === 'sm' ? 12 : 16;
    return <span style={{display:'inline-flex',alignItems:'center',gap:3,color,fontSize: size==='sm'?12:15,fontWeight:600}}>
      <Ic size={sz} color={color}/>{isUp?'+':''}{gain}%
    </span>;
  };

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREENS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  const SetupScreen = () => (
    <div style={{height:'100%',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:32}}>
      <div style={{width:80,height:80,borderRadius:20,background:'linear-gradient(135deg,#d4a853,#b8860b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:36,marginBottom:24}}>üíé</div>
      <h1 style={{fontSize:26,fontWeight:700,color:'#fff',marginBottom:6}}>Welcome to item2value</h1>
      <p className="text-muted" style={{fontSize:14,textAlign:'center',marginBottom:32,lineHeight:1.5}}>Track your inventory, monitor market values, and maximize your returns.</p>

      <div style={{width:'100%',maxWidth:320}}>
        <FormField label="Your Name" required>
          <input ref={profileNameRef} className="form-input" defaultValue="" placeholder="e.g. Jordan" style={inputStyle}/>
        </FormField>
        <FormField label="Email" required>
          <input ref={profileEmailRef} className="form-input" type="email" defaultValue="" placeholder="e.g. you@email.com" style={inputStyle}/>
        </FormField>

        <button onClick={() => {
          const name = profileNameRef.current?.value?.trim() || '';
          const email = profileEmailRef.current?.value?.trim() || '';
          if (!name) { alert('Please enter your name.'); return; }
          if (!email) { alert('Please enter your email.'); return; }
          const newProfile = { name, email, createdAt: new Date().toISOString() };
          setProfile(newProfile);
          setScreen('home');
        }} className="gradient-amber" style={{width:'100%',border:'none',borderRadius:14,padding:'16px 0',fontSize:16,fontWeight:700,color:'#000',cursor:'pointer',marginTop:8}}>
          Get Started
        </button>
      </div>
    </div>
  );

  const HomeScreen = () => (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      {/* Header */}
      <div style={{padding:'32px 24px 8px'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:28}}>
          <div>
            <p className="text-dim" style={{fontSize:13,letterSpacing:1,textTransform:'uppercase'}}>{getGreeting()}</p>
            <h1 style={{fontSize:28,fontWeight:700,color:'#fff',marginTop:4}}>{userName}</h1>
          </div>
          <div className="gradient-amber" style={{width:44,height:44,borderRadius:22,display:'flex',alignItems:'center',justifyContent:'center',fontSize:18,fontWeight:700,color:'#000'}}>{userInitial}</div>
        </div>

        {/* Stats Grid */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          {[
            {label:'Total Items',val:String(items.length),icon:'Package',grad:'linear-gradient(135deg,#3b82f6,#2563eb)'},
            {label:'Total Value',val:fmt(totalValue),icon:'Dollar',grad:'linear-gradient(135deg,#d4a853,#b8860b)',tip:'The combined market value of all items currently in your inventory.'},
            {label:'Total Earnings',val: totalEarnings > 0 ? fmt(totalEarnings) : '--',icon:'BarChart',grad:'linear-gradient(135deg,#a855f7,#7c3aed)',tip:'Total revenue from items you\'ve sold. Tap to see all sold items.',onClick:() => setScreen('sold-items')},
            {label:'Top Gainer',val: topGainer ? `+${getItemGain(topGainer)}%` : '--',icon:'TrendUp',grad:'linear-gradient(135deg,#22c55e,#16a34a)',tip: topGainer ? `Your best performing item by % gain. Currently: ${topGainer.name}` : 'Add items to see your top performer.'},
          ].map((c,i) => {
            const Ic = Icons[c.icon];
            return <div key={i} className="glass anim-up" style={{borderRadius:16,padding:16,animationDelay:`${i*0.08}s`,cursor:c.onClick?'pointer':'default',overflow:'visible',position:'relative'}} onClick={c.onClick || undefined}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start'}}>
                <div>
                  <div style={{display:'flex',alignItems:'center'}}>
                    <p className="text-dim" style={{fontSize:11,textTransform:'uppercase',letterSpacing:1}}>{c.label}</p>
                    {c.tip && <InfoTip text={c.tip}/>}
                  </div>
                  <p style={{fontSize:22,fontWeight:700,color:'#fff',marginTop:6}}>{c.val}</p>
                </div>
                <div style={{width:40,height:40,borderRadius:10,background:c.grad,display:'flex',alignItems:'center',justifyContent:'center'}}>
                  <Ic size={20} color="#fff"/>
                </div>
              </div>
            </div>;
          })}
        </div>
      </div>

      {/* Action Buttons */}
      <div style={{padding:'20px 24px',display:'flex',gap:12}}>
        <button onClick={() => setScreen('scan')} className="gradient-amber" style={{flex:1,border:'none',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:600,color:'#000',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:8}}>
          <Icons.Camera size={20} color="#000"/>Scan Item
        </button>
        <button onClick={() => setScreen('add-item')} className="glass glass-hover" style={{flex:1,border:'1px solid rgba(255,255,255,0.12)',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:600,color:'#fff',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:8,background:'rgba(255,255,255,0.06)'}}>
          <Icons.Plus size={20}/>Add Manually
        </button>
      </div>

      {/* Portfolio by Sector */}
      {(() => {
        const categories = {};
        items.forEach(item => {
          if (!categories[item.category]) categories[item.category] = {items:[], totalValue:0, totalCost:0};
          categories[item.category].items.push(item);
          categories[item.category].totalValue += item.value;
          categories[item.category].totalCost += getItemCost(item);
        });
        const sectorIcons = {Fashion:'üëú',Electronics:'üì±',Home:'üè†',Watches:'‚åö',Art:'üé®',Sports:'‚öΩ',Other:'üì¶'};
        const sectorColors = {Fashion:'#e879f9',Electronics:'#3b82f6',Home:'#f59e0b',Watches:'#22c55e',Art:'#f472b6',Sports:'#fb923c',Other:'#94a3b8'};
        const sectors = Object.entries(categories).map(([cat, data]) => {
          const gainPct = data.totalCost > 0 ? ((data.totalValue - data.totalCost) / data.totalCost) * 100 : 0;
          const gainDollar = data.totalValue - data.totalCost;
          return {cat, ...data, gainPct, gainDollar};
        });
        return (
          <div style={{padding:'12px 24px'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}}>
              <h2 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Portfolio</h2>
              <span className="text-dim" style={{fontSize:11}}>Total Gain/Loss</span>
            </div>
            {sectors.length === 0 ? (
              <div className="glass" style={{borderRadius:14,padding:24,textAlign:'center'}}>
                <p style={{fontSize:32,marginBottom:8}}>üìä</p>
                <p className="text-muted" style={{fontSize:13}}>No sectors yet. Add items to see your portfolio breakdown.</p>
              </div>
            ) : (
            <div style={{display:'flex',flexDirection:'column',gap:10}}>
              {sectors.map((s,i) => {
                const isUp = s.gainDollar >= 0;
                return (
                  <div key={s.cat} className="glass glass-hover anim-right" style={{borderRadius:14,padding:16,cursor:'pointer',animationDelay:`${i*0.06}s`}} onClick={() => {setFilter(s.cat);setScreen('inventory');}}>
                    <div style={{display:'flex',alignItems:'center',gap:12}}>
                      <div style={{width:44,height:44,borderRadius:12,background:`${sectorColors[s.cat]}20`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:22}}>{sectorIcons[s.cat]||'üì¶'}</div>
                      <div style={{flex:1,minWidth:0}}>
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                          <p style={{fontWeight:600,color:'#fff',fontSize:14}}>{s.cat}</p>
                          <p className="text-gold" style={{fontWeight:700,fontSize:15}}>{fmt(s.totalValue)}</p>
                        </div>
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:4}}>
                          <p className="text-dim" style={{fontSize:12}}>{s.items.length} item{s.items.length>1?'s':''}</p>
                          <span style={{fontSize:13,fontWeight:600,color:isUp?'#4ade80':'#f87171',display:'flex',alignItems:'center',gap:3}}>
                            {isUp?<Icons.TrendUp size={13} color="#4ade80"/>:<Icons.TrendDown size={13} color="#f87171"/>}
                            {isUp?'+':''}{s.gainPct.toFixed(1)}% ({isUp?'+':''}${Math.abs(Math.round(s.gainDollar)).toLocaleString()})
                          </span>
                        </div>
                        {/* Mini bar showing value allocation */}
                        <div style={{marginTop:8,height:4,borderRadius:2,background:'rgba(255,255,255,0.06)',overflow:'hidden'}}>
                          <div style={{height:'100%',borderRadius:2,background:sectorColors[s.cat],width:`${Math.min(100,(s.totalValue/totalValue)*100)}%`,transition:'width 0.5s ease'}}/>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
            )}
          </div>
        );
      })()}

      {/* Watchlist: Biggest Movers */}
      {(() => {
        const sorted = [...items].sort((a,b) => Math.abs(getItemGain(b)) - Math.abs(getItemGain(a)));
        return (
          <div style={{padding:'16px 24px'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}}>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <h2 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Watchlist</h2>
                <InfoTip text="Your items ranked by biggest market moves. Updates as new comparable listings appear across marketplaces."/>
              </div>
              <button onClick={() => setScreen('inventory')} style={{background:'none',border:'none',color:'#d4a853',fontSize:13,fontWeight:600,cursor:'pointer'}}>View All</button>
            </div>
            {sorted.length === 0 ? (
              <div className="glass" style={{borderRadius:14,padding:24,textAlign:'center'}}>
                <p style={{fontSize:32,marginBottom:8}}>üëÄ</p>
                <p className="text-muted" style={{fontSize:13}}>Your watchlist is empty. Add items to track their market moves.</p>
              </div>
            ) : (<React.Fragment>
            {/* Table header */}
            <div style={{display:'grid',gridTemplateColumns:'1fr auto auto',gap:8,padding:'0 4px 8px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}>
              <span className="text-dim" style={{fontSize:10,textTransform:'uppercase',letterSpacing:1}}>Item</span>
              <span className="text-dim" style={{fontSize:10,textTransform:'uppercase',letterSpacing:1,textAlign:'right',minWidth:70}}>Mkt Value</span>
              <span className="text-dim" style={{fontSize:10,textTransform:'uppercase',letterSpacing:1,textAlign:'right',minWidth:80}}>Daily Chg</span>
            </div>
            <div style={{display:'flex',flexDirection:'column'}}>
              {sorted.map((item,i) => {
                const dailyDollar = item.value * (getItemGain(item) / 100) * 0.1;
                const dailyPct = (getItemGain(item) * 0.1);
                const isUp = dailyPct >= 0;
                return (
                  <div key={item.id} onClick={() => goItem(item.id)} className="anim-right" style={{display:'grid',gridTemplateColumns:'1fr auto auto',gap:8,padding:'12px 4px',borderBottom:'1px solid rgba(255,255,255,0.04)',cursor:'pointer',alignItems:'center',animationDelay:`${i*0.04}s`}}>
                    <div style={{display:'flex',alignItems:'center',gap:10,minWidth:0}}>
                      <span style={{fontSize:20}}>{item.emoji}</span>
                      <div style={{minWidth:0}}>
                        <p className="truncate" style={{fontWeight:600,color:'#fff',fontSize:13}}>{item.name}</p>
                        <p className="text-dim" style={{fontSize:11}}>{item.category}</p>
                      </div>
                    </div>
                    <p style={{fontWeight:600,color:'#fff',fontSize:14,textAlign:'right',minWidth:70}}>{fmt(item.value)}</p>
                    <div style={{textAlign:'right',minWidth:80}}>
                      <p style={{fontSize:13,fontWeight:600,color:isUp?'#4ade80':'#f87171'}}>{isUp?'+':''}{dailyPct.toFixed(2)}%</p>
                      <p style={{fontSize:11,color:isUp?'#4ade80':'#f87171',opacity:0.8}}>{isUp?'+':''}${Math.abs(Math.round(dailyDollar)).toLocaleString()}</p>
                    </div>
                  </div>
                );
              })}
            </div>
            </React.Fragment>)}
          </div>
        );
      })()}
    </div>
  );

  const ScanScreen = () => (
    <div style={{height:'100%',background:'#000',display:'flex',flexDirection:'column',position:'relative'}}>
      {/* Header */}
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px',position:'relative',zIndex:10}}>
        <button onClick={() => {setScreen('home');setScanning(false);setAnalyzing(false);setAiDone(false);}} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
        <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Scan Item</h1>
        <div style={{width:24}}/>
      </div>
      {/* Coming Soon overlay */}
      <div style={{position:'absolute',inset:0,zIndex:20,background:'rgba(0,0,0,0.85)',backdropFilter:'blur(12px)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:32}}>
        <div style={{width:80,height:80,borderRadius:20,background:'rgba(212,168,83,0.12)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:40,marginBottom:20}}>üì∏</div>
        <h2 style={{fontSize:22,fontWeight:700,color:'#fff',marginBottom:8}}>Coming Soon</h2>
        <p className="text-muted" style={{fontSize:14,textAlign:'center',lineHeight:1.5,maxWidth:280}}>AI-powered item scanning will automatically identify your items and pull market data. For now, use "+ Add Manually" to build your inventory.</p>
        <button onClick={() => setScreen('add-item')} className="gradient-amber" style={{border:'none',borderRadius:14,padding:'14px 32px',fontSize:15,fontWeight:600,color:'#000',cursor:'pointer',marginTop:24}}>+ Add Manually</button>
        <button onClick={() => {setScreen('home');setScanning(false);setAnalyzing(false);setAiDone(false);}} style={{background:'none',border:'none',color:'#94a3b8',fontSize:14,cursor:'pointer',marginTop:12}}>Back to Home</button>
      </div>

      {/* Viewfinder */}
      <div style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center'}}>
        <div style={{width:260,height:320,borderRadius:24,border:'3px solid rgba(255,255,255,0.2)',position:'relative',overflow:'hidden',background:'linear-gradient(180deg,#0a0a0f,#1a1a2e)'}}>
          {/* Corner brackets */}
          {['top:0;left:0','top:0;right:0','bottom:0;left:0','bottom:0;right:0'].map((pos,i) => {
            const s = pos.split(';').reduce((o,p) => {const [k,v]=p.split(':');o[k]=v;return o;},{});
            return <div key={i} style={{position:'absolute',...s,width:28,height:28,borderColor:'rgba(255,255,255,0.5)',borderStyle:'solid',borderWidth: i<2?(i%2===0?'2px 0 0 2px':'2px 2px 0 0'):(i%2===0?'0 0 2px 2px':'0 2px 2px 0')}}/>;
          })}
          {/* Scan line animation */}
          {scanning && <>
            <div style={{position:'absolute',inset:0,background:'linear-gradient(180deg,transparent,rgba(212,168,83,0.15),transparent)',animation:'pulse 1.5s ease-in-out infinite'}}/>
            <div style={{position:'absolute',left:0,right:0,height:2,background:'linear-gradient(90deg,transparent,#d4a853,transparent)',animation:'scanLine 2s ease-in-out infinite'}}/>
          </>}
          {/* Center icon */}
          {!scanning && <div style={{position:'absolute',inset:0,display:'flex',alignItems:'center',justifyContent:'center',opacity:0.3}}>
            <Icons.Camera size={48} color="#fff"/>
          </div>}
        </div>
      </div>

      {/* Bottom controls */}
      <div style={{padding:'0 24px 48px',display:'flex',flexDirection:'column',alignItems:'center',gap:16,position:'relative',zIndex:10}}>
        <button onClick={takePhoto} disabled={scanning} style={{width:72,height:72,borderRadius:36,background: scanning ? 'rgba(212,168,83,0.5)' : 'linear-gradient(135deg,#d4a853,#b8860b)',border:'none',cursor: scanning?'default':'pointer',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 0 40px rgba(212,168,83,0.3)'}}>
          <Icons.Camera size={30} color="#000"/>
        </button>
        <button style={{width:'100%',background:'rgba(255,255,255,0.08)',border:'1px solid rgba(255,255,255,0.12)',borderRadius:14,padding:'14px 0',color:'#fff',fontSize:14,fontWeight:600,cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:8}}>
          <Icons.Upload size={16}/>Upload from Gallery
        </button>
      </div>
    </div>
  );

  const AIScreen = () => (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      {/* Header */}
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px'}}>
        <button onClick={() => {setScreen('scan');setAnalyzing(false);setAiDone(false);}} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
        <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Item Analysis</h1>
        <div style={{width:24}}/>
      </div>

      {/* Photo */}
      <div style={{padding:'0 24px 24px'}}>
        <div style={{width:'100%',height:240,borderRadius:20,background:'linear-gradient(135deg,#334155,#1e293b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:80,position:'relative',overflow:'hidden'}}>
          üëú
          <div style={{position:'absolute',bottom:0,left:0,right:0,height:'40%',background:'linear-gradient(to top,rgba(10,10,15,0.6),transparent)'}}/>
        </div>
      </div>

      {analyzing ? (
        <div className="anim-fade" style={{padding:'40px 24px',textAlign:'center'}}>
          <div style={{position:'relative',width:64,height:64,margin:'0 auto 20px'}}>
            <div style={{position:'absolute',inset:0,border:'2px solid transparent',borderTopColor:'#d4a853',borderRadius:'50%',animation:'spin 1s linear infinite'}}/>
            <div style={{position:'absolute',inset:8,border:'2px solid transparent',borderRightColor:'#b8860b',borderRadius:'50%',animation:'spinReverse 0.8s linear infinite'}}/>
          </div>
          <p style={{fontSize:20,fontWeight:600,color:'#fff'}}>Analyzing...</p>
          <p className="text-muted" style={{fontSize:14,marginTop:8}}>AI is identifying your item</p>
          <div style={{marginTop:20,height:4,borderRadius:2,background:'rgba(255,255,255,0.06)',overflow:'hidden'}}>
            <div style={{height:'100%',width:'60%',borderRadius:2,background:'linear-gradient(90deg,#d4a853,#b8860b,#d4a853)',backgroundSize:'200% 100%',animation:'shimmer 1.5s ease-in-out infinite'}}/>
          </div>
        </div>
      ) : aiDone ? (
        <div className="anim-up" style={{padding:'0 24px'}}>
          {/* Prediction card */}
          <div className="glass" style={{borderRadius:16,padding:20,marginBottom:16}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:8}}>
              <h3 style={{fontSize:18,fontWeight:700,color:'#fff',flex:1,marginRight:12}}>Louis Vuitton Neverfull MM</h3>
              <div style={{background:'rgba(34,197,94,0.15)',border:'1px solid rgba(34,197,94,0.25)',borderRadius:8,padding:'4px 10px',flexShrink:0}}>
                <span style={{fontSize:12,fontWeight:600,color:'#4ade80'}}>94% Match</span>
              </div>
            </div>
            <p className="text-muted" style={{fontSize:14}}>Damier Ebene Pattern</p>
          </div>

          {/* Details */}
          <div style={{display:'flex',flexDirection:'column',gap:10,marginBottom:24}}>
            {[['Category','Handbags & Purses'],['Brand','Louis Vuitton'],['Model','Neverfull MM'],['Material','Canvas & Leather'],['Condition','Excellent']].map(([k,v],i) => (
              <div key={i} className="glass" style={{borderRadius:12,padding:'14px 16px',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <span className="text-muted" style={{fontSize:13}}>{k}</span>
                <span style={{fontWeight:600,color:'#fff',fontSize:14}}>{v}</span>
              </div>
            ))}
          </div>

          {/* Actions */}
          <button onClick={() => {setSelectedId(1);setScreen('pricing');}} className="gradient-amber" style={{width:'100%',border:'none',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:700,color:'#000',cursor:'pointer',marginBottom:12}}>
            Search Comps
          </button>
          <button onClick={() => {setScreen('inventory');setAiDone(false);}} className="glass glass-hover" style={{width:'100%',border:'1px solid rgba(255,255,255,0.12)',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:600,color:'#fff',cursor:'pointer',background:'rgba(255,255,255,0.06)'}}>
            Save to Inventory
          </button>
        </div>
      ) : null}
    </div>
  );

  /* ‚îÄ‚îÄ Add Item Form ‚îÄ‚îÄ */
  const emojiOptions = ['üì¶','üëú','üëü','ü™ë','üì∑','‚åö','üç≤','üì±','üéí','üéÆ','üíª','üñºÔ∏è','üé∏','üíé','üß•'];
  const categoryOptions = ['Fashion','Electronics','Home','Watches','Art','Sports','Other'];
  const conditionOptions = ['New','Like New','Excellent','Very Good','Good','Fair'];

  // Use refs for text inputs to prevent re-renders (fixes iOS keyboard dismissal)
  const formRefs = {
    name: useRef(null),
    brand: useRef(null),
    model: useRef(null),
    cost: useRef(null),
    datePurchased: useRef(null),
    asking: useRef(null),
    market: useRef(null),
    notes: useRef(null),
  };
  // Only emoji, category, condition, and photos use state (no keyboard involved)
  const [addFormUI, setAddFormUI] = useState({category:'Fashion',condition:'Good',emoji:'üì¶',photos:[]});

  const resetAddForm = () => {
    Object.values(formRefs).forEach(ref => { if (ref.current) ref.current.value = ''; });
    setAddFormUI({category:'Fashion',condition:'Good',emoji:'üì¶',photos:[]});
  };

  const AddItemScreen = () => (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      {/* Header */}
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px',position:'sticky',top:0,background:'linear-gradient(180deg,#0a0a0f 80%,transparent)',zIndex:20}}>
        <button onClick={() => setScreen('home')} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
        <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Add Item</h1>
        <div style={{width:24}}/>
      </div>

      <div style={{padding:'0 24px'}}>
        {/* Emoji picker */}
        <FormField label="Icon">
          <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
            {emojiOptions.map(e => (
              <button key={e} onClick={() => setAddFormUI(prev => ({...prev,emoji:e}))} style={{width:44,height:44,borderRadius:10,fontSize:22,display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer',border: addFormUI.emoji===e ? '2px solid #d4a853' : '1px solid rgba(255,255,255,0.1)',background: addFormUI.emoji===e ? 'rgba(212,168,83,0.15)' : 'rgba(255,255,255,0.04)'}}>{e}</button>
            ))}
          </div>
        </FormField>

        {/* Photo Upload */}
        <FormField label={`Photos (${addFormUI.photos.length}/5)`} tip="Add up to 5 photos. First photo becomes the cover image shown in your inventory.">
          <div style={{display:'flex',gap:10,flexWrap:'wrap'}}>
            {addFormUI.photos.map((photo,idx) => (
              <div key={idx} style={{width:72,height:72,borderRadius:12,overflow:'hidden',position:'relative',border:'1px solid rgba(255,255,255,0.1)'}}>
                <img src={photo} style={{width:'100%',height:'100%',objectFit:'cover'}}/>
                {idx===0 && <div style={{position:'absolute',bottom:0,left:0,right:0,background:'rgba(212,168,83,0.9)',padding:'2px 0',textAlign:'center'}}><span style={{fontSize:8,fontWeight:700,color:'#000',textTransform:'uppercase',letterSpacing:0.5}}>Cover</span></div>}
                <button onClick={() => setAddFormUI(prev => ({...prev,photos:prev.photos.filter((_,i)=>i!==idx)}))} style={{position:'absolute',top:4,right:4,width:20,height:20,borderRadius:10,background:'rgba(0,0,0,0.7)',border:'none',color:'#fff',fontSize:12,cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',lineHeight:1}}>√ó</button>
              </div>
            ))}
            {addFormUI.photos.length < 5 && (
              <label style={{width:72,height:72,borderRadius:12,border:'2px dashed rgba(255,255,255,0.15)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',cursor:'pointer',background:'rgba(255,255,255,0.03)',gap:4}}>
                <Icons.Camera size={20} color="#64748b"/>
                <span style={{fontSize:9,color:'#64748b',fontWeight:600}}>Add</span>
                <input type="file" accept="image/*" multiple style={{display:'none'}} onChange={e => {
                  const files = Array.from(e.target.files).slice(0, 5 - addFormUI.photos.length);
                  files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = async (ev) => {
                      const compressed = await compressPhoto(ev.target.result);
                      setAddFormUI(prev => ({...prev, photos: [...prev.photos, compressed].slice(0,5)}));
                    };
                    reader.readAsDataURL(file);
                  });
                  e.target.value = '';
                }}/>
              </label>
            )}
          </div>
        </FormField>

        {/* Item name */}
        <FormField label="Item Name" required>
          <input ref={formRefs.name} className="form-input" defaultValue="" placeholder="e.g. Louis Vuitton Neverfull MM" style={inputStyle}/>
        </FormField>

        {/* Brand + Model row */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <FormField label="Brand">
            <input ref={formRefs.brand} className="form-input" defaultValue="" placeholder="e.g. Nike" style={inputStyle}/>
          </FormField>
          <FormField label="Model">
            <input ref={formRefs.model} className="form-input" defaultValue="" placeholder="e.g. Dunk Low" style={inputStyle}/>
          </FormField>
        </div>

        {/* Category + Condition row */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <FormField label="Category" required>
            <select value={addFormUI.category} onChange={e => setAddFormUI(prev => ({...prev,category:e.target.value}))} style={{...inputStyle,cursor:'pointer'}}>
              {categoryOptions.map(c => <option key={c} value={c}>{c}</option>)}
            </select>
          </FormField>
          <FormField label="Condition">
            <select value={addFormUI.condition} onChange={e => setAddFormUI(prev => ({...prev,condition:e.target.value}))} style={{...inputStyle,cursor:'pointer'}}>
              {conditionOptions.map(c => <option key={c} value={c}>{c}</option>)}
            </select>
          </FormField>
        </div>

        {/* Divider */}
        <div style={{borderTop:'1px solid rgba(255,255,255,0.08)',margin:'8px 0 20px'}}/>
        <h3 style={{fontSize:14,fontWeight:700,color:'#fff',marginBottom:16}}>Pricing</h3>

        {/* What I Paid */}
        <FormField label="What I Paid" required tip="The total amount you spent to acquire this item, including tax and shipping.">
          <div style={{position:'relative'}}>
            <span style={{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:'#64748b',fontSize:14,fontWeight:600}}>$</span>
            <input ref={formRefs.cost} className="form-input" type="number" defaultValue="" placeholder="0.00" style={{...inputStyle,paddingLeft:28}}/>
          </div>
        </FormField>

        {/* Date Purchased */}
        <FormField label="Date Purchased" tip="When you bought or acquired this item.">
          <input ref={formRefs.datePurchased} className="form-input" type="date" defaultValue="" style={{...inputStyle,colorScheme:'dark'}}/>
        </FormField>

        {/* My Asking Price */}
        <FormField label="My Asking Price" tip="The price you'd list this item for if you sold it today. Leave blank to auto-set to market value.">
          <div style={{position:'relative'}}>
            <span style={{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:'#64748b',fontSize:14,fontWeight:600}}>$</span>
            <input ref={formRefs.asking} className="form-input" type="number" defaultValue="" placeholder="Optional" style={{...inputStyle,paddingLeft:28}}/>
          </div>
        </FormField>

        {/* Estimated Market Value */}
        <FormField label="Estimated Market Value" tip="What you think this item is worth based on your research. You can update this anytime.">
          <div style={{position:'relative'}}>
            <span style={{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:'#64748b',fontSize:14,fontWeight:600}}>$</span>
            <input ref={formRefs.market} className="form-input" type="number" defaultValue="" placeholder="Optional" style={{...inputStyle,paddingLeft:28}}/>
          </div>
        </FormField>

        {/* Notes */}
        <FormField label="Notes">
          <textarea ref={formRefs.notes} className="form-input" defaultValue="" placeholder="Any extra details, serial numbers, where you bought it..." rows={3} style={{...inputStyle,resize:'vertical',minHeight:60}}/>
        </FormField>

        {/* Submit */}
        <button onClick={() => {
          const name = formRefs.name.current?.value?.trim() || '';
          const cost = formRefs.cost.current?.value || '';
          if (!name || !cost) { alert('Please enter an item name and what you paid.'); return; }
          const newItem = {
            id: Date.now(),
            name: name,
            brand: formRefs.brand.current?.value?.trim() || '',
            model: formRefs.model.current?.value?.trim() || '',
            category: addFormUI.category,
            condition: addFormUI.condition,
            cost: parseFloat(cost) || 0,
            asking: parseFloat(formRefs.asking.current?.value) || 0,
            value: parseFloat(formRefs.market.current?.value) || parseFloat(formRefs.asking.current?.value) || parseFloat(cost) || 0,
            emoji: addFormUI.emoji,
            notes: formRefs.notes.current?.value?.trim() || '',
            photos: addFormUI.photos,
            comps: [],
            createdAt: new Date().toISOString(),
            datePurchased: formRefs.datePurchased.current?.value || null,
            earnings: null,
            dateSold: null,
            priceHistory: [{date: new Date().toISOString().slice(0,10), value: parseFloat(formRefs.market.current?.value) || parseFloat(formRefs.asking.current?.value) || parseFloat(cost) || 0, cost: parseFloat(cost) || 0, asking: parseFloat(formRefs.asking.current?.value) || 0}],
          };
          setItems(prev => [newItem, ...prev]);
          resetAddForm();
          setScreen('inventory');
        }} className="gradient-amber" style={{width:'100%',border:'none',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:700,color:'#000',cursor:'pointer',marginBottom:12}}>
          Save to Inventory
        </button>
        <button onClick={() => {resetAddForm();setScreen('home');}} style={{width:'100%',background:'rgba(255,255,255,0.06)',border:'1px solid rgba(255,255,255,0.12)',borderRadius:14,padding:'14px 0',color:'#fff',fontSize:14,fontWeight:600,cursor:'pointer'}}>
          Cancel
        </button>
      </div>
    </div>
  );

  const initEditForm = (item) => {
    setEditFormUI({category:item.category,condition:item.condition,emoji:item.emoji,photos:item.photos||[]});
    setTimeout(() => {
      if (editRefs.name.current) editRefs.name.current.value = item.name || '';
      if (editRefs.brand.current) editRefs.brand.current.value = item.brand || '';
      if (editRefs.model.current) editRefs.model.current.value = item.model || '';
      if (editRefs.notes.current) editRefs.notes.current.value = item.notes || '';
    }, 50);
  };

  const EditItemScreen = () => {
    if (!selected) return null;
    return (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px',position:'sticky',top:0,background:'linear-gradient(180deg,#0a0a0f 80%,transparent)',zIndex:20}}>
        <button onClick={() => setScreen('detail')} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
        <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Edit Item</h1>
        <div style={{width:24}}/>
      </div>

      <div style={{padding:'0 24px'}}>
        {/* Emoji picker */}
        <FormField label="Icon">
          <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
            {emojiOptions.map(e => (
              <button key={e} onClick={() => setEditFormUI(prev => ({...prev,emoji:e}))} style={{width:44,height:44,borderRadius:10,fontSize:22,display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer',border: editFormUI.emoji===e ? '2px solid #d4a853' : '1px solid rgba(255,255,255,0.1)',background: editFormUI.emoji===e ? 'rgba(212,168,83,0.15)' : 'rgba(255,255,255,0.04)'}}>{e}</button>
            ))}
          </div>
        </FormField>

        {/* Photo Management */}
        <FormField label={`Photos (${editFormUI.photos.length}/5)`} tip="Add up to 5 photos. First photo becomes the cover image.">
          <div style={{display:'flex',gap:10,flexWrap:'wrap'}}>
            {editFormUI.photos.map((photo,idx) => (
              <div key={idx} style={{width:72,height:72,borderRadius:12,overflow:'hidden',position:'relative',border:'1px solid rgba(255,255,255,0.1)'}}>
                <img src={photo} style={{width:'100%',height:'100%',objectFit:'cover'}}/>
                {idx===0 && <div style={{position:'absolute',bottom:0,left:0,right:0,background:'rgba(212,168,83,0.9)',padding:'2px 0',textAlign:'center'}}><span style={{fontSize:8,fontWeight:700,color:'#000',textTransform:'uppercase',letterSpacing:0.5}}>Cover</span></div>}
                <button onClick={() => setEditFormUI(prev => ({...prev,photos:prev.photos.filter((_,i)=>i!==idx)}))} style={{position:'absolute',top:4,right:4,width:20,height:20,borderRadius:10,background:'rgba(0,0,0,0.7)',border:'none',color:'#fff',fontSize:12,cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',lineHeight:1}}>√ó</button>
              </div>
            ))}
            {editFormUI.photos.length < 5 && (
              <label style={{width:72,height:72,borderRadius:12,border:'2px dashed rgba(255,255,255,0.15)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',cursor:'pointer',background:'rgba(255,255,255,0.03)',gap:4}}>
                <Icons.Camera size={20} color="#64748b"/>
                <span style={{fontSize:9,color:'#64748b',fontWeight:600}}>Add</span>
                <input type="file" accept="image/*" multiple style={{display:'none'}} onChange={e => {
                  const files = Array.from(e.target.files).slice(0, 5 - editFormUI.photos.length);
                  files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = async (ev) => {
                      const compressed = await compressPhoto(ev.target.result);
                      setEditFormUI(prev => ({...prev, photos: [...prev.photos, compressed].slice(0,5)}));
                    };
                    reader.readAsDataURL(file);
                  });
                  e.target.value = '';
                }}/>
              </label>
            )}
          </div>
        </FormField>

        {/* Item name */}
        <FormField label="Item Name" required>
          <input ref={editRefs.name} className="form-input" defaultValue="" placeholder="e.g. Louis Vuitton Neverfull MM" style={inputStyle}/>
        </FormField>

        {/* Brand + Model row */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <FormField label="Brand">
            <input ref={editRefs.brand} className="form-input" defaultValue="" placeholder="e.g. Nike" style={inputStyle}/>
          </FormField>
          <FormField label="Model">
            <input ref={editRefs.model} className="form-input" defaultValue="" placeholder="e.g. Dunk Low" style={inputStyle}/>
          </FormField>
        </div>

        {/* Category + Condition row */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <FormField label="Category" required>
            <select value={editFormUI.category} onChange={e => setEditFormUI(prev => ({...prev,category:e.target.value}))} style={{...inputStyle,cursor:'pointer'}}>
              {categoryOptions.map(c => <option key={c} value={c}>{c}</option>)}
            </select>
          </FormField>
          <FormField label="Condition">
            <select value={editFormUI.condition} onChange={e => setEditFormUI(prev => ({...prev,condition:e.target.value}))} style={{...inputStyle,cursor:'pointer'}}>
              {conditionOptions.map(c => <option key={c} value={c}>{c}</option>)}
            </select>
          </FormField>
        </div>

        {/* Notes */}
        <FormField label="Notes">
          <textarea ref={editRefs.notes} className="form-input" defaultValue="" placeholder="Any extra details, serial numbers, where you bought it..." rows={3} style={{...inputStyle,resize:'vertical',minHeight:60}}/>
        </FormField>

        {/* Save */}
        <button onClick={() => {
          const name = editRefs.name.current?.value?.trim() || '';
          if (!name) { alert('Item name is required.'); return; }
          setItems(prev => prev.map(it => it.id === selected.id ? {
            ...it,
            name,
            brand: editRefs.brand.current?.value?.trim() || '',
            model: editRefs.model.current?.value?.trim() || '',
            category: editFormUI.category,
            condition: editFormUI.condition,
            emoji: editFormUI.emoji,
            notes: editRefs.notes.current?.value?.trim() || '',
            photos: editFormUI.photos,
          } : it));
          setScreen('detail');
        }} className="gradient-amber" style={{width:'100%',border:'none',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:700,color:'#000',cursor:'pointer',marginBottom:12}}>
          Save Changes
        </button>
        <button onClick={() => setScreen('detail')} style={{width:'100%',background:'rgba(255,255,255,0.06)',border:'1px solid rgba(255,255,255,0.12)',borderRadius:14,padding:'14px 0',color:'#fff',fontSize:14,fontWeight:600,cursor:'pointer'}}>
          Cancel
        </button>
      </div>
    </div>
    );
  };

  const InventoryScreen = () => (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      {/* Header */}
      <div style={{padding:'20px 24px 0',position:'sticky',top:0,background:'linear-gradient(180deg,#0a0a0f 80%,transparent)',zIndex:20,paddingBottom:16}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:16}}>
          <div style={{display:'flex',alignItems:'center',gap:10}}>
            <h1 style={{fontSize:24,fontWeight:700,color:'#fff'}}>Inventory</h1>
            {items.length > 0 && <span style={{background:'rgba(212,168,83,0.15)',color:'#d4a853',fontSize:12,fontWeight:700,padding:'4px 10px',borderRadius:20}}>{items.length}</span>}
          </div>
          <button onClick={() => setViewMode(viewMode==='grid'?'list':'grid')} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}>
            {viewMode==='grid' ? <Icons.List size={22}/> : <Icons.Grid size={22}/>}
          </button>
        </div>

        {/* Search */}
        <div className="glass" style={{borderRadius:12,padding:'12px 14px',display:'flex',alignItems:'center',gap:10,marginBottom:14}}>
          <Icons.Search size={16} color="#64748b"/>
          <input value={search} onChange={e => setSearch(e.target.value)} placeholder="Search items..." style={{background:'none',border:'none',outline:'none',color:'#fff',fontSize:14,width:'100%'}}/>
        </div>

        {/* Filters */}
        <div className="scroll-hide" style={{display:'flex',gap:8,overflowX:'auto',marginBottom:12}}>
          {['All', ...categoryOptions.filter(cat => items.some(i => i.category === cat))].map(f => (
            <button key={f} onClick={() => setFilter(f)} style={{padding:'8px 16px',borderRadius:10,fontSize:13,fontWeight:600,whiteSpace:'nowrap',cursor:'pointer',border: filter===f?'none':'1px solid rgba(255,255,255,0.1)',background: filter===f?'linear-gradient(135deg,#d4a853,#b8860b)':'rgba(255,255,255,0.04)',color: filter===f?'#000':'#fff'}}>{f}</button>
          ))}
        </div>

        {/* Sort */}
        <div style={{display:'flex',alignItems:'center',gap:8}}>
          <Icons.Filter size={14} color="#64748b"/>
          <select value={sortBy} onChange={e => setSortBy(e.target.value)} style={{background:'rgba(255,255,255,0.04)',border:'1px solid rgba(255,255,255,0.1)',color:'#fff',fontSize:13,borderRadius:8,padding:'6px 10px',outline:'none'}}>
            <option value="value-high">Value: High to Low</option>
            <option value="value-low">Value: Low to High</option>
            <option value="gain">Biggest Gains</option>
          </select>
        </div>
      </div>

      {/* Items */}
      <div style={{padding:'12px 24px'}}>
        {filtered.length === 0 ? (
          <div style={{textAlign:'center',padding:'48px 24px'}}>
            <p style={{fontSize:48,marginBottom:12}}>üì¶</p>
            <p style={{fontSize:16,fontWeight:600,color:'#fff',marginBottom:6}}>{items.length === 0 ? 'No items yet' : 'No matches found'}</p>
            <p className="text-muted" style={{fontSize:13,marginBottom:20}}>{items.length === 0 ? 'Tap "+ Add Manually" to start building your inventory.' : 'Try a different search or filter.'}</p>
            {items.length === 0 && <button onClick={() => setScreen('add-item')} className="gradient-amber" style={{border:'none',borderRadius:12,padding:'12px 24px',fontSize:14,fontWeight:600,color:'#000',cursor:'pointer'}}>+ Add Your First Item</button>}
          </div>
        ) : viewMode === 'grid' ? (
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
            {filtered.map((item,i) => (
              <div key={item.id} onClick={() => goItem(item.id)} className="glass glass-hover anim-up" style={{borderRadius:16,overflow:'hidden',cursor:'pointer',animationDelay:`${i*0.06}s`}}>
                <div style={{width:'100%',height:120,background:'linear-gradient(135deg,#334155,#1e293b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:44,overflow:'hidden',position:'relative'}}>
                  {item.photos && item.photos.length > 0 ? <img src={item.photos[0]} style={{width:'100%',height:'100%',objectFit:'cover'}}/> : item.emoji}
                  {item.earnings && item.earnings > 0 && <div style={{position:'absolute',top:6,right:6,background:'rgba(34,197,94,0.9)',borderRadius:6,padding:'2px 6px',fontSize:9,fontWeight:700,color:'#fff'}}>SOLD</div>}
                </div>
                <div style={{padding:12}}>
                  <p className="truncate" style={{fontWeight:600,color:'#fff',fontSize:13}}>{item.name}</p>
                  <p className="text-dim" style={{fontSize:11,marginTop:3}}>{item.condition}</p>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:10}}>
                    <span className="text-gold" style={{fontWeight:700,fontSize:14}}>{fmt(item.value)}</span>
                    <GainBadge gain={getItemGain(item)}/>
                  </div>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <div style={{display:'flex',flexDirection:'column',gap:10}}>
            {filtered.map((item,i) => (
              <div key={item.id} onClick={() => goItem(item.id)} className="glass glass-hover anim-right" style={{borderRadius:14,padding:16,display:'flex',alignItems:'center',gap:14,cursor:'pointer',animationDelay:`${i*0.04}s`}}>
                <div style={{width:56,height:56,borderRadius:12,background:'linear-gradient(135deg,#334155,#1e293b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:28,flexShrink:0,overflow:'hidden'}}>
                  {item.photos && item.photos.length > 0 ? <img src={item.photos[0]} style={{width:'100%',height:'100%',objectFit:'cover'}}/> : item.emoji}
                </div>
                <div style={{flex:1,minWidth:0}}>
                  <p className="truncate" style={{fontWeight:600,color:'#fff',fontSize:14}}>{item.name}</p>
                  <p className="text-dim" style={{fontSize:12,marginTop:3}}>{item.condition}</p>
                </div>
                <div style={{textAlign:'right',flexShrink:0}}>
                  <p className="text-gold" style={{fontWeight:700,fontSize:15}}>{fmt(item.value)}</p>
                  <div style={{marginTop:3}}><GainBadge gain={getItemGain(item)}/></div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );

  const DetailScreen = () => {
    if (!selected) return null;
    const currentCost = getItemCost(selected);
    const profit = selected.value - currentCost;
    const gainPct = currentCost === 0 ? 0 : Math.round(((selected.value - currentCost) / currentCost) * 100);
    return (
      <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
        {/* Header */}
        <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px',position:'sticky',top:0,background:'linear-gradient(180deg,#0a0a0f 80%,transparent)',zIndex:20}}>
          <button onClick={() => {setScreen('inventory');setEditingCost(false);}} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
          <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Details</h1>
          <button onClick={() => alert('Sharing is coming soon!')} style={{background:'none',border:'none',color:'#475569',cursor:'pointer'}}><Icons.Share size={22}/></button>
        </div>

        {/* Photo Gallery */}
        <div style={{padding:'0 24px 20px'}}>
          <div style={{width:'100%',height:280,borderRadius:24,background:'linear-gradient(135deg,#334155,#1e293b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:80,position:'relative',overflow:'hidden'}}
            onTouchStart={e => { e.currentTarget._touchX = e.touches[0].clientX; }}
            onTouchEnd={e => {
              const diff = e.currentTarget._touchX - e.changedTouches[0].clientX;
              const total = selected.photos?.length || 0;
              if (total > 1) {
                if (diff > 40) setPhotoIndex(prev => Math.min(prev + 1, total - 1));
                if (diff < -40) setPhotoIndex(prev => Math.max(prev - 1, 0));
              }
            }}>
            {selected.photos && selected.photos.length > 0 ? (
              <img src={selected.photos[photoIndex] || selected.photos[0]} style={{width:'100%',height:'100%',objectFit:'cover',transition:'opacity 0.2s ease'}} />
            ) : (
              selected.emoji
            )}
            <div style={{position:'absolute',bottom:0,left:0,right:0,height:'30%',background:'linear-gradient(to top,rgba(10,10,15,0.5),transparent)'}}/>
            {/* Left/Right tap zones */}
            {selected.photos && selected.photos.length > 1 && (
              <React.Fragment>
                {photoIndex > 0 && <div onClick={() => setPhotoIndex(prev => prev - 1)} style={{position:'absolute',left:0,top:0,bottom:0,width:'30%',cursor:'pointer'}}/>}
                {photoIndex < selected.photos.length - 1 && <div onClick={() => setPhotoIndex(prev => prev + 1)} style={{position:'absolute',right:0,top:0,bottom:0,width:'30%',cursor:'pointer'}}/>}
              </React.Fragment>
            )}
            {/* Photo counter */}
            {selected.photos && selected.photos.length > 1 && (
              <div style={{position:'absolute',top:12,right:12,background:'rgba(0,0,0,0.6)',borderRadius:12,padding:'4px 10px',fontSize:11,fontWeight:600,color:'#fff'}}>{photoIndex + 1}/{selected.photos.length}</div>
            )}
            {/* Dots */}
            {selected.photos && selected.photos.length > 0 && (
              <div style={{position:'absolute',bottom:16,left:'50%',transform:'translateX(-50%)',display:'flex',gap:6}}>
                {selected.photos.map((_, idx) => (
                  <div key={idx} onClick={() => setPhotoIndex(idx)} style={{width: idx === photoIndex ? 24 : 6, height:6, borderRadius:3, background: idx === photoIndex ? '#fff' : 'rgba(255,255,255,0.3)', transition:'width 0.2s ease', cursor:'pointer'}}/>
                ))}
              </div>
            )}
          </div>
        </div>

        <div style={{padding:'0 24px'}}>
          <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:4}}>
            <h2 style={{fontSize:22,fontWeight:700,color:'#fff'}}>{selected.name}</h2>
            {selected.earnings && selected.earnings > 0 && <span style={{background:'rgba(34,197,94,0.15)',color:'#22c55e',fontSize:10,fontWeight:700,padding:'3px 8px',borderRadius:6}}>SOLD</span>}
          </div>
          <p className="text-muted" style={{fontSize:13,marginBottom:24}}>{selected.category} ¬∑ {selected.condition}</p>

          {/* Valuation */}
          {(() => {
            const currentAsking = getItemAsking(selected);
            const currentEarnings = selected.earnings || 0;
            const hasSold = currentEarnings > 0;
            const investProfit = currentAsking - currentCost;
            const investPct = currentCost === 0 ? 0 : Math.round((investProfit / currentCost) * 100);
            const resaleDiff = currentAsking - selected.value;
            const resalePct = selected.value === 0 ? 0 : Math.round((resaleDiff / selected.value) * 100);
            const netProfit = hasSold ? (currentEarnings - currentCost) : (currentAsking - currentCost);
            const netPct = currentCost === 0 ? 0 : Math.round((netProfit / currentCost) * 100);

            const EditableBox = ({label, value, editing, setEditing, input, setInput, onSave, tip, color='#fff', placeholder}) => (
              <div className="glass" style={{borderRadius:12,padding:'12px 8px',textAlign:'center',cursor:'pointer',border: editing ? '1px solid rgba(212,168,83,0.5)' : '1px solid rgba(255,255,255,0.08)',minWidth:0,boxSizing:'border-box'}} onClick={() => {if(!editing){setEditing(true);setInput(value != null ? String(value) : '');}}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:3}}>
                  <p className="text-dim" style={{fontSize:9,textTransform:'uppercase',letterSpacing:0.8,whiteSpace:'nowrap'}}>{label}</p>
                  <Icons.Edit size={8} color="#475569"/>
                  {tip && <InfoTip text={tip}/>}
                </div>
                {editing ? (
                  <div style={{marginTop:6,display:'flex',alignItems:'center',justifyContent:'center',gap:3}}>
                    <span style={{fontSize:18,fontWeight:700,color:'#d4a853'}}>$</span>
                    <input autoFocus type="number" value={input} onChange={e => setInput(e.target.value)}
                      onKeyDown={e => { if(e.key==='Enter'){onSave();} if(e.key==='Escape'){setEditing(false);} }}
                      onBlur={onSave}
                      style={{width:70,fontSize:18,fontWeight:700,color:'#fff',background:'transparent',border:'none',borderBottom:'2px solid #d4a853',outline:'none',textAlign:'center',fontFamily:'DM Sans, sans-serif'}}
                      onClick={e => e.stopPropagation()}/>
                  </div>
                ) : (
                  <p style={{fontSize:18,fontWeight:700,color,marginTop:6}}>{value != null ? fmt(value) : (placeholder || '--')}</p>
                )}
                {!editing && <p className="text-dim" style={{fontSize:8,marginTop:3}}>tap to edit</p>}
              </div>
            );

            return (
            <div className="glass" style={{borderRadius:16,padding:16,marginBottom:16}}>
              <h3 style={{fontSize:16,fontWeight:700,color:'#fff',marginBottom:14}}>Valuation</h3>
              {/* 2x2 price boxes */}
              <div style={{display:'grid',gridTemplateColumns:'repeat(2, 1fr)',gap:10,marginBottom:12,width:'100%',boxSizing:'border-box'}}>
                <EditableBox label="What I Paid" value={currentCost} editing={editingCost} setEditing={setEditingCost} input={costInput} setInput={setCostInput} tip="Total you spent acquiring this item."
                  onSave={() => {
                    const v = parseFloat(costInput);
                    if (!isNaN(v) && v >= 0) {
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, cost: v} : it));
                    }
                    setEditingCost(false);
                  }}/>
                <EditableBox label="Asking Price" value={currentAsking} editing={editingAsking} setEditing={setEditingAsking} input={askingInput} setInput={setAskingInput} tip="The price you'd list this at if you sold today." color="#d4a853"
                  onSave={() => {
                    const v = parseFloat(askingInput);
                    if (!isNaN(v) && v >= 0) {
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, asking: v} : it));
                    }
                    setEditingAsking(false);
                  }}/>
                <EditableBox label="Market" value={selected.value} editing={editingMarket} setEditing={setEditingMarket} input={marketInput} setInput={setMarketInput} tip="Your estimate of fair market value based on comparable listings." color="#94a3b8"
                  onSave={() => {
                    const v = parseFloat(marketInput);
                    if (!isNaN(v) && v >= 0) {
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, value: v} : it));
                      recordPriceSnapshot(selected.id, v);
                    }
                    setEditingMarket(false);
                  }}/>
                <EditableBox label="Earnings" value={currentEarnings || null} editing={editingEarnings} setEditing={setEditingEarnings} input={earningsInput} setInput={setEarningsInput} tip="What you actually sold this item for, including any fees or deductions." color="#22c55e" placeholder="--"
                  onSave={() => {
                    const v = parseFloat(earningsInput);
                    if (!isNaN(v) && v >= 0) {
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, earnings: v} : it));
                    } else if (earningsInput === '' || earningsInput === '0') {
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, earnings: null} : it));
                    }
                    setEditingEarnings(false);
                  }}/>
              </div>

              {/* Date fields */}
              <div style={{display:'grid',gridTemplateColumns: hasSold ? '1fr 1fr' : '1fr',gap:10,marginBottom:16}}>
                <div>
                  <p className="text-dim" style={{fontSize:9,textTransform:'uppercase',letterSpacing:0.8,marginBottom:4}}>Date Purchased</p>
                  <input type="date" value={selected.datePurchased || ''} onChange={e => {
                    setItems(prev => prev.map(it => it.id === selected.id ? {...it, datePurchased: e.target.value || null} : it));
                  }} style={{width:'100%',background:'rgba(255,255,255,0.04)',border:'1px solid rgba(255,255,255,0.1)',borderRadius:8,padding:'8px 10px',color:'#fff',fontSize:12,outline:'none',fontFamily:'DM Sans, sans-serif',colorScheme:'dark'}}/>
                </div>
                {hasSold && (
                  <div>
                    <p className="text-dim" style={{fontSize:9,textTransform:'uppercase',letterSpacing:0.8,marginBottom:4}}>Date Sold</p>
                    <input type="date" value={selected.dateSold || ''} onChange={e => {
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, dateSold: e.target.value || null} : it));
                    }} style={{width:'100%',background:'rgba(255,255,255,0.04)',border:'1px solid rgba(255,255,255,0.1)',borderRadius:8,padding:'8px 10px',color:'#fff',fontSize:12,outline:'none',fontFamily:'DM Sans, sans-serif',colorScheme:'dark'}}/>
                  </div>
                )}
              </div>

              {/* Metrics */}
              <div style={{borderTop:'1px solid rgba(255,255,255,0.08)',paddingTop:14,display:'flex',flexDirection:'column',gap:10}}>
                {/* Investment Return: asking vs paid */}
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <div style={{display:'flex',alignItems:'center',gap:4}}>
                    <span className="text-muted" style={{fontSize:12}}>Investment Return</span>
                    <InfoTip text="Your return if you sell at your asking price. (Asking Price - What You Paid) / What You Paid."/>
                  </div>
                  <span style={{fontSize:14,fontWeight:700,color:investProfit>=0?'#4ade80':'#f87171',display:'flex',alignItems:'center',gap:4}}>
                    {investProfit>=0?<Icons.TrendUp size={14} color="#4ade80"/>:<Icons.TrendDown size={14} color="#f87171"/>}
                    {investProfit>=0?'+':''}{investPct}% ({investProfit>=0?'+':''}${Math.abs(investProfit).toLocaleString()})
                  </span>
                </div>
                {/* Resale Premium: asking vs market */}
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <div style={{display:'flex',alignItems:'center',gap:4}}>
                    <span className="text-muted" style={{fontSize:12}}>Resale Premium</span>
                    <InfoTip text="How your asking price compares to market. Positive = you're priced above market."/>
                  </div>
                  <span style={{fontSize:14,fontWeight:700,color:resaleDiff>=0?'#4ade80':'#f87171',display:'flex',alignItems:'center',gap:4}}>
                    {resaleDiff>=0?<Icons.TrendUp size={14} color="#4ade80"/>:<Icons.TrendDown size={14} color="#f87171"/>}
                    {resaleDiff>=0?'+':''}{resalePct}% ({resaleDiff>=0?'+':''}${Math.abs(resaleDiff).toLocaleString()})
                  </span>
                </div>
                {/* Net Profit: conditional based on whether item sold */}
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',borderTop:'1px solid rgba(255,255,255,0.06)',paddingTop:10}}>
                  <div style={{display:'flex',alignItems:'center',gap:4}}>
                    <span style={{fontSize:13,fontWeight:600,color:'#cbd5e1'}}>{hasSold ? 'Net Profit' : 'Net Profit if Sold'}</span>
                    <InfoTip text={hasSold ? "Your actual profit: what you earned minus what you paid." : "Your asking price minus what you paid. This is your projected profit if someone buys at your price."}/>
                  </div>
                  <span style={{fontSize:15,fontWeight:700,color:netProfit>=0?'#4ade80':'#f87171',display:'flex',alignItems:'center',gap:4}}>
                    {netProfit>=0?<Icons.TrendUp size={16} color="#4ade80"/>:<Icons.TrendDown size={16} color="#f87171"/>}
                    {netProfit>=0?'+':''}${Math.abs(netProfit).toLocaleString()}
                  </span>
                </div>
              </div>
            </div>
            );
          })()}

          {/* Price History Chart */}
          <div className="glass" style={{borderRadius:16,padding:20,marginBottom:16}}>
            <h3 style={{fontSize:16,fontWeight:700,color:'#fff',marginBottom:12}}>Price History</h3>
            {(() => {
              const history = selected.priceHistory || [];
              if (history.length < 2) {
                return (
                  <div style={{padding:'20px 0',textAlign:'center'}}>
                    <Icons.Clock size={28} color="#475569"/>
                    <p className="text-dim" style={{fontSize:12,marginTop:8}}>{history.length === 0 ? 'No price history yet. Update market value to start tracking.' : 'Update market value again to see your price trend. Each change is recorded.'}</p>
                  </div>
                );
              }
              // SVG line chart
              const W = 300, H = 120, padX = 40, padY = 16;
              const values = history.map(h => h.value);
              const minV = Math.min(...values) * 0.95;
              const maxV = Math.max(...values) * 1.05;
              const rangeV = maxV - minV || 1;
              const points = history.map((h, i) => {
                const x = padX + (i / (history.length - 1)) * (W - padX - 8);
                const y = padY + (1 - (h.value - minV) / rangeV) * (H - padY * 2);
                return {x, y, ...h};
              });
              const linePath = points.map((p, i) => `${i === 0 ? 'M' : 'L'}${p.x},${p.y}`).join(' ');
              const areaPath = linePath + ` L${points[points.length-1].x},${H-padY} L${points[0].x},${H-padY} Z`;
              const isUp = values[values.length-1] >= values[0];
              const lineColor = isUp ? '#4ade80' : '#f87171';
              return (
                <div>
                  <svg viewBox={`0 0 ${W} ${H}`} style={{width:'100%',height:'auto'}}>
                    {/* Grid lines */}
                    {[0,0.25,0.5,0.75,1].map((pct,i) => {
                      const y = padY + pct * (H - padY * 2);
                      const val = Math.round(maxV - pct * rangeV);
                      return <React.Fragment key={i}>
                        <line x1={padX} y1={y} x2={W-8} y2={y} stroke="rgba(255,255,255,0.06)" strokeWidth="0.5"/>
                        {i % 2 === 0 && <text x={padX-4} y={y+3} fill="#475569" fontSize="7" textAnchor="end" fontFamily="DM Sans">${val.toLocaleString()}</text>}
                      </React.Fragment>;
                    })}
                    {/* Area fill */}
                    <path d={areaPath} fill={`${lineColor}12`}/>
                    {/* Line */}
                    <path d={linePath} fill="none" stroke={lineColor} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    {/* Dots */}
                    {points.map((p, i) => (
                      <circle key={i} cx={p.x} cy={p.y} r={i === points.length-1 ? 4 : 2.5} fill={i === points.length-1 ? lineColor : '#1e293b'} stroke={lineColor} strokeWidth="1.5"/>
                    ))}
                  </svg>
                  {/* Date labels */}
                  <div style={{display:'flex',justifyContent:'space-between',marginTop:4,paddingLeft:40}}>
                    <span className="text-dim" style={{fontSize:9}}>{new Date(history[0].date).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span>
                    <span className="text-dim" style={{fontSize:9}}>{new Date(history[history.length-1].date).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span>
                  </div>
                  {/* Summary */}
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:10,paddingTop:10,borderTop:'1px solid rgba(255,255,255,0.06)'}}>
                    <span className="text-dim" style={{fontSize:11}}>{history.length} data point{history.length>1?'s':''}</span>
                    <span style={{fontSize:12,fontWeight:600,color:lineColor}}>
                      {isUp?'+':''}{Math.round(((values[values.length-1]-values[0])/values[0])*100)}% overall
                    </span>
                  </div>
                </div>
              );
            })()}
          </div>

          {/* Comps */}
          <div className="glass" style={{borderRadius:16,padding:20,marginBottom:20}}>
            <h3 style={{fontSize:16,fontWeight:700,color:'#fff',marginBottom:16}}>Comparable Listings</h3>
            {getComps(selected.id).length === 0 && !addingComp && (
              <p className="text-dim" style={{fontSize:13,textAlign:'center',padding:'12px 0'}}>No comparables yet. Add one below.</p>
            )}
            <div style={{display:'flex',flexDirection:'column',gap:10}}>
              {getComps(selected.id).map(c => (
                editingCompId === c.id ? (
                  <div key={c.id} className="glass anim-fade" style={{borderRadius:12,padding:14}}>
                    <div style={{display:'flex',flexDirection:'column',gap:8}}>
                      <input className="form-input" value={compForm.title} onChange={e => updateCompForm('title',e.target.value)} placeholder="Listing title" style={inputStyle}/>
                      <input className="form-input" value={compForm.url} onChange={e => updateCompForm('url',e.target.value)} placeholder="URL" style={inputStyle}/>
                      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
                        <div style={{position:'relative'}}>
                          <span style={{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:'#64748b',fontSize:14,fontWeight:600}}>$</span>
                          <input className="form-input" type="number" value={compForm.price} onChange={e => updateCompForm('price',e.target.value)} placeholder="Price" style={{...inputStyle,paddingLeft:28}}/>
                        </div>
                        <select value={compForm.source} onChange={e => updateCompForm('source',e.target.value)} style={{...inputStyle,cursor:'pointer'}}>
                          {['eBay','Poshmark','Mercari','StockX','Facebook Marketplace','Craigslist','The RealReal','Vestiaire','Other'].map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                      </div>
                      <select value={compForm.condition} onChange={e => updateCompForm('condition',e.target.value)} style={{...inputStyle,cursor:'pointer'}}>
                        {['New','Like New','Excellent','Very Good','Good','Fair'].map(co => <option key={co} value={co}>{co}</option>)}
                      </select>
                      <div style={{display:'flex',gap:8}}>
                        <button onClick={() => {
                          if (!compForm.title || !compForm.price) return;
                          setItems(prev => prev.map(it => it.id === selected.id ? {...it, comps: (it.comps||[]).map(comp => comp.id === c.id ? {...comp, title:compForm.title, url:compForm.url, price:parseFloat(compForm.price), source:compForm.source, condition:compForm.condition} : comp)} : it));
                          setTimeout(() => recalcMarketFromComps(selected.id), 50);
                          setEditingCompId(null);
                          setCompForm({title:'',url:'',price:'',source:'eBay',condition:'Good'});
                        }} className="gradient-amber" style={{flex:1,border:'none',borderRadius:10,padding:'10px 0',fontSize:13,fontWeight:700,color:'#000',cursor:'pointer'}}>Save</button>
                        <button onClick={() => {setEditingCompId(null);setCompForm({title:'',url:'',price:'',source:'eBay',condition:'Good'});}} style={{flex:1,background:'rgba(255,255,255,0.06)',border:'1px solid rgba(255,255,255,0.12)',borderRadius:10,padding:'10px 0',color:'#fff',fontSize:13,fontWeight:600,cursor:'pointer'}}>Cancel</button>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div key={c.id} className="glass glass-hover" style={{borderRadius:12,padding:14,position:'relative'}}>
                    <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                      <span className="text-dim" style={{fontSize:11,textTransform:'uppercase',letterSpacing:0.5}}>{c.source}</span>
                      <span className="text-gold" style={{fontWeight:700,fontSize:14}}>{fmt(c.price)}</span>
                    </div>
                    <p className="truncate" style={{color:'#fff',fontSize:13,marginBottom:6}}>{c.title}</p>
                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                      <div>
                        <span className="text-dim" style={{fontSize:11}}>{c.condition}</span>
                        <span className="text-dim" style={{fontSize:11,marginLeft:8}}>{c.date}</span>
                      </div>
                      <div style={{display:'flex',gap:6}}>
                        <button onClick={(e) => {e.stopPropagation();setEditingCompId(c.id);setCompForm({title:c.title,url:c.url||'',price:String(c.price),source:c.source,condition:c.condition});}} style={{background:'rgba(255,255,255,0.08)',border:'none',borderRadius:6,padding:'4px 8px',cursor:'pointer',display:'flex',alignItems:'center',gap:4}}>
                          <Icons.Edit size={12} color="#94a3b8"/><span style={{fontSize:10,color:'#94a3b8'}}>Edit</span>
                        </button>
                        <button onClick={(e) => {e.stopPropagation();if(confirm('Delete this comparable?')){setItems(prev => prev.map(it => it.id === selected.id ? {...it, comps: (it.comps||[]).filter(comp => comp.id !== c.id)} : it));setTimeout(() => recalcMarketFromComps(selected.id), 50);}}} style={{background:'rgba(239,68,68,0.1)',border:'none',borderRadius:6,padding:'4px 8px',cursor:'pointer',display:'flex',alignItems:'center',gap:4}}>
                          <span style={{fontSize:10,color:'#f87171'}}>Delete</span>
                        </button>
                      </div>
                    </div>
                  </div>
                )
              ))}
            </div>

            {/* Add Comp Form */}
            {addingComp ? (
              <div className="glass anim-fade" style={{borderRadius:12,padding:16,marginTop:10}}>
                <p style={{fontSize:13,fontWeight:600,color:'#fff',marginBottom:12}}>Add Comparable Listing</p>
                <div style={{display:'flex',flexDirection:'column',gap:10}}>
                  <input className="form-input" value={compForm.title} onChange={e => updateCompForm('title',e.target.value)} placeholder="Listing title (e.g. Sony A7III Body Only)" style={inputStyle}/>
                  <input className="form-input" value={compForm.url} onChange={e => updateCompForm('url',e.target.value)} placeholder="URL (paste eBay/Poshmark link)" style={inputStyle}/>
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
                    <div style={{position:'relative'}}>
                      <span style={{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:'#64748b',fontSize:14,fontWeight:600}}>$</span>
                      <input className="form-input" type="number" value={compForm.price} onChange={e => updateCompForm('price',e.target.value)} placeholder="Price" style={{...inputStyle,paddingLeft:28}}/>
                    </div>
                    <select value={compForm.source} onChange={e => updateCompForm('source',e.target.value)} style={{...inputStyle,cursor:'pointer'}}>
                      {['eBay','Poshmark','Mercari','StockX','Facebook Marketplace','Craigslist','The RealReal','Vestiaire','Other'].map(s => <option key={s} value={s}>{s}</option>)}
                    </select>
                  </div>
                  <select value={compForm.condition} onChange={e => updateCompForm('condition',e.target.value)} style={{...inputStyle,cursor:'pointer'}}>
                    {['New','Like New','Excellent','Very Good','Good','Fair'].map(co => <option key={co} value={co}>{co}</option>)}
                  </select>
                  <div style={{display:'flex',gap:10}}>
                    <button onClick={() => {
                      if (!compForm.title || !compForm.price) return;
                      const newComp = {
                        id: Date.now(),
                        source: compForm.source,
                        title: compForm.title,
                        price: parseFloat(compForm.price),
                        condition: compForm.condition,
                        date: 'just now',
                        url: compForm.url,
                      };
                      setItems(prev => prev.map(it => it.id === selected.id ? {...it, comps: [...(it.comps||[]), newComp]} : it));
                      setTimeout(() => recalcMarketFromComps(selected.id), 50);
                      setCompForm({title:'',url:'',price:'',source:'eBay',condition:'Good'});
                      setAddingComp(false);
                    }} className="gradient-amber" style={{flex:1,border:'none',borderRadius:10,padding:'12px 0',fontSize:13,fontWeight:700,color:'#000',cursor:'pointer'}}>
                      Save Comp
                    </button>
                    <button onClick={() => {setAddingComp(false);setCompForm({title:'',url:'',price:'',source:'eBay',condition:'Good'});}} style={{flex:1,background:'rgba(255,255,255,0.06)',border:'1px solid rgba(255,255,255,0.12)',borderRadius:10,padding:'12px 0',color:'#fff',fontSize:13,fontWeight:600,cursor:'pointer'}}>
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            ) : (
              <button onClick={() => {setAddingComp(true);setEditingCompId(null);setCompForm({title:'',url:'',price:'',source:'eBay',condition:'Good'});}} className="glass glass-hover" style={{width:'100%',border:'1px solid rgba(255,255,255,0.12)',borderRadius:12,padding:'14px 0',fontSize:13,fontWeight:600,color:'#d4a853',cursor:'pointer',background:'rgba(255,255,255,0.04)',display:'flex',alignItems:'center',justifyContent:'center',gap:8,marginTop:10}}>
                <Icons.Plus size={16} color="#d4a853"/>Add Comparable
              </button>
            )}
          </div>

          {/* Actions */}
          <button onClick={() => setScreen('pricing')} className="gradient-amber" style={{width:'100%',border:'none',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:700,color:'#000',cursor:'pointer',marginBottom:12}}>
            Refresh Price
          </button>
          <button onClick={() => { initEditForm(selected); setScreen('edit-item'); }} className="glass glass-hover" style={{width:'100%',border:'1px solid rgba(255,255,255,0.12)',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:600,color:'#fff',cursor:'pointer',background:'rgba(255,255,255,0.06)',display:'flex',alignItems:'center',justifyContent:'center',gap:8,marginBottom:8}}>
            <Icons.Edit size={16}/>Edit Item
          </button>
          <button onClick={() => {
            if (confirm('Delete this item from your inventory?')) {
              setItems(prev => prev.filter(it => it.id !== selected.id));
              setScreen('inventory');
            }
          }} style={{width:'100%',background:'rgba(239,68,68,0.1)',border:'1px solid rgba(239,68,68,0.25)',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:600,color:'#f87171',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:8}}>
            Delete Item
          </button>
        </div>
      </div>
    );
  };

  const PricingScreen = () => (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px'}}>
        <button onClick={() => selected ? setScreen('detail') : setScreen('home')} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
        <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Market Analysis</h1>
        <div style={{width:24}}/>
      </div>

      <div style={{padding:'0 24px'}}>
        {/* Item summary */}
        {selected && (
          <div className="glass" style={{borderRadius:14,padding:16,display:'flex',alignItems:'center',gap:14,marginBottom:20}}>
            <div style={{width:48,height:48,borderRadius:10,background:'linear-gradient(135deg,#334155,#1e293b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:24}}>{selected.emoji}</div>
            <div>
              <p style={{fontWeight:600,color:'#fff',fontSize:14}}>{selected.name}</p>
              <p className="text-dim" style={{fontSize:12,marginTop:2}}>{selected.condition}</p>
            </div>
          </div>
        )}

        {/* Price Range - calculated from real comps */}
        {(() => {
          const comps = selected ? getComps(selected.id) : [];
          const prices = comps.map(c => c.price).filter(p => p > 0);
          const hasComps = prices.length > 0;
          const low = hasComps ? Math.min(...prices) : (selected ? selected.value * 0.85 : 0);
          const high = hasComps ? Math.max(...prices) : (selected ? selected.value * 1.15 : 0);
          const avg = hasComps ? Math.round(prices.reduce((s,p) => s+p, 0) / prices.length) : (selected ? selected.value : 0);
          const confidence = Math.min(95, prices.length * 20 + (prices.length >= 3 ? 15 : 0));
          const markerPos = hasComps && high > low ? Math.round(((avg - low) / (high - low)) * 100) : 50;
          return (
          <div className="glass" style={{borderRadius:16,padding:20,marginBottom:16}}>
            <h3 style={{fontSize:16,fontWeight:700,color:'#fff',marginBottom:16}}>Estimated Market Range</h3>
            {/* Range bar */}
            <div style={{height:8,borderRadius:4,background:'linear-gradient(90deg,#f87171,#d4a853,#4ade80)',marginBottom:20,position:'relative'}}>
              <div style={{position:'absolute',top:-4,left:`${markerPos}%`,transform:'translateX(-50%)',width:16,height:16,borderRadius:8,background:'#fff',border:'3px solid #d4a853',boxShadow:'0 0 12px rgba(212,168,83,0.4)'}}/>
            </div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
              {[{l:'Low',p:Math.round(low),c:'#f87171'},{l:'Average',p:avg,c:'#d4a853'},{l:'High',p:Math.round(high),c:'#4ade80'}].map((r,i) => (
                <div key={i} className="glass" style={{borderRadius:12,padding:12,textAlign:'center'}}>
                  <p className="text-dim" style={{fontSize:10,textTransform:'uppercase',letterSpacing:1}}>{r.l}</p>
                  <p style={{fontSize:18,fontWeight:700,color:r.c,marginTop:6}}>{fmt(r.p)}</p>
                </div>
              ))}
            </div>

            {/* Confidence */}
            <div style={{marginTop:16,paddingTop:16,borderTop:'1px solid rgba(255,255,255,0.08)'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <span className="text-muted" style={{fontSize:13}}>Confidence Score</span>
                <div style={{display:'flex',alignItems:'center',gap:8}}>
                  <div style={{width:80,height:6,borderRadius:3,background:'rgba(255,255,255,0.08)',overflow:'hidden'}}>
                    <div style={{width:`${confidence}%`,height:'100%',borderRadius:3,background:'linear-gradient(90deg,#d4a853,#b8860b)'}}/>
                  </div>
                  <span className="text-gold" style={{fontWeight:700,fontSize:13}}>{confidence}%</span>
                </div>
              </div>
              <p className="text-dim" style={{fontSize:11,marginTop:6}}>{hasComps ? `Based on ${prices.length} comp${prices.length>1?'s':''}` : 'Add comparables to improve accuracy'}</p>
            </div>
          </div>
          );
        })()}

        {/* Comps */}
        <div className="glass" style={{borderRadius:16,padding:20,marginBottom:20}}>
          <h3 style={{fontSize:16,fontWeight:700,color:'#fff',marginBottom:16}}>Comparable Listings</h3>
          <div style={{display:'flex',flexDirection:'column',gap:10}}>
            {(selected ? getComps(selected.id) : getComps(1)).map(c => (
              <div key={c.id} className="glass glass-hover" style={{borderRadius:12,padding:14,cursor:'pointer'}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                  <span style={{fontWeight:600,color:'#fff',fontSize:13}}>{c.source}</span>
                  <span className="text-gold" style={{fontWeight:700,fontSize:14}}>{fmt(c.price)}</span>
                </div>
                <p className="truncate text-muted" style={{fontSize:12,marginBottom:6}}>{c.title}</p>
                <div style={{display:'flex',justifyContent:'space-between'}}>
                  <span className="text-dim" style={{fontSize:11}}>{c.condition}</span>
                  <span className="text-dim" style={{fontSize:11}}>{c.date}</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        <button onClick={() => alert('Price alerts are coming soon! Check the Alerts tab for inventory insights.')} style={{width:'100%',border:'1px solid rgba(212,168,83,0.3)',borderRadius:14,padding:'16px 0',fontSize:15,fontWeight:600,color:'#94a3b8',cursor:'pointer',background:'rgba(255,255,255,0.03)',display:'flex',alignItems:'center',justifyContent:'center',gap:8}}>
          <Icons.Bell size={16} color="#94a3b8"/>Set Price Alert <span style={{fontSize:10,background:'rgba(212,168,83,0.15)',color:'#d4a853',padding:'2px 6px',borderRadius:4,fontWeight:700}}>SOON</span>
        </button>
      </div>
    </div>
  );

  const SoldItemsScreen = () => {
    const sold = soldItems
      .filter(i => (soldFilter === 'All' || i.category === soldFilter) && i.name.toLowerCase().includes(soldSearch.toLowerCase()))
      .sort((a,b) => {
        if (soldSort === 'recent') return (b.dateSold || b.createdAt || '').localeCompare(a.dateSold || a.createdAt || '');
        if (soldSort === 'profit') return ((b.earnings - b.cost) - (a.earnings - a.cost));
        if (soldSort === 'fastest') {
          const daysA = a.dateSold && (a.datePurchased || a.createdAt) ? Math.round((new Date(a.dateSold) - new Date(a.datePurchased || a.createdAt)) / (1000*60*60*24)) : 9999;
          const daysB = b.dateSold && (b.datePurchased || b.createdAt) ? Math.round((new Date(b.dateSold) - new Date(b.datePurchased || b.createdAt)) / (1000*60*60*24)) : 9999;
          return daysA - daysB;
        }
        return 0;
      });
    const totalSoldProfit = soldItems.reduce((s,i) => s + (i.earnings - i.cost), 0);
    const avgDaysToSell = (() => {
      const withDates = soldItems.filter(i => i.dateSold && (i.datePurchased || i.createdAt));
      if (withDates.length === 0) return '--';
      const total = withDates.reduce((s,i) => s + Math.round((new Date(i.dateSold) - new Date(i.datePurchased || i.createdAt)) / (1000*60*60*24)), 0);
      return Math.round(total / withDates.length);
    })();
    const getDaysToSell = (item) => {
      if (!item.dateSold || !(item.datePurchased || item.createdAt)) return '--';
      return Math.round((new Date(item.dateSold) - new Date(item.datePurchased || item.createdAt)) / (1000*60*60*24));
    };
    return (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'20px 24px',position:'sticky',top:0,background:'linear-gradient(180deg,#0a0a0f 80%,transparent)',zIndex:20}}>
        <button onClick={() => setScreen('home')} style={{background:'none',border:'none',color:'#fff',cursor:'pointer'}}><Icons.ArrowLeft size={24}/></button>
        <h1 style={{fontSize:18,fontWeight:700,color:'#fff'}}>Sold Items</h1>
        <div style={{width:24}}/>
      </div>

      <div style={{padding:'0 24px'}}>
        {/* Summary stats */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10,marginBottom:16}}>
          <div className="glass" style={{borderRadius:12,padding:12,textAlign:'center'}}>
            <p className="text-dim" style={{fontSize:9,textTransform:'uppercase',letterSpacing:0.8}}>Earnings</p>
            <p style={{fontSize:16,fontWeight:700,color:'#22c55e',marginTop:4}}>{totalEarnings > 0 ? fmt(totalEarnings) : '--'}</p>
          </div>
          <div className="glass" style={{borderRadius:12,padding:12,textAlign:'center'}}>
            <p className="text-dim" style={{fontSize:9,textTransform:'uppercase',letterSpacing:0.8}}>Items Sold</p>
            <p style={{fontSize:16,fontWeight:700,color:'#fff',marginTop:4}}>{soldItems.length}</p>
          </div>
          <div className="glass" style={{borderRadius:12,padding:12,textAlign:'center'}}>
            <p className="text-dim" style={{fontSize:9,textTransform:'uppercase',letterSpacing:0.8}}>Avg Days</p>
            <p style={{fontSize:16,fontWeight:700,color:'#d4a853',marginTop:4}}>{avgDaysToSell}{avgDaysToSell !== '--' ? 'd' : ''}</p>
          </div>
        </div>

        {/* Net profit banner */}
        <div className="glass" style={{borderRadius:12,padding:14,marginBottom:16,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <span className="text-muted" style={{fontSize:13}}>Net Profit (all sold)</span>
          <span style={{fontSize:16,fontWeight:700,color:totalSoldProfit>=0?'#4ade80':'#f87171'}}>
            {totalSoldProfit>=0?'+':''}${Math.abs(totalSoldProfit).toLocaleString()}
          </span>
        </div>

        {/* Search */}
        <div className="glass" style={{borderRadius:12,padding:'12px 14px',display:'flex',alignItems:'center',gap:10,marginBottom:14}}>
          <Icons.Search size={16} color="#64748b"/>
          <input value={soldSearch} onChange={e => setSoldSearch(e.target.value)} placeholder="Search sold items..." style={{background:'none',border:'none',outline:'none',color:'#fff',fontSize:14,width:'100%'}}/>
        </div>

        {/* Filters */}
        <div className="scroll-hide" style={{display:'flex',gap:8,overflowX:'auto',marginBottom:12}}>
          {['All', ...categoryOptions.filter(cat => soldItems.some(i => i.category === cat))].map(f => (
            <button key={f} onClick={() => setSoldFilter(f)} style={{padding:'8px 16px',borderRadius:10,fontSize:13,fontWeight:600,whiteSpace:'nowrap',cursor:'pointer',border: soldFilter===f?'none':'1px solid rgba(255,255,255,0.1)',background: soldFilter===f?'linear-gradient(135deg,#d4a853,#b8860b)':'rgba(255,255,255,0.04)',color: soldFilter===f?'#000':'#fff'}}>{f}</button>
          ))}
        </div>

        {/* Sort */}
        <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:16}}>
          <Icons.Filter size={14} color="#64748b"/>
          <select value={soldSort} onChange={e => setSoldSort(e.target.value)} style={{background:'rgba(255,255,255,0.04)',border:'1px solid rgba(255,255,255,0.1)',color:'#fff',fontSize:13,borderRadius:8,padding:'6px 10px',outline:'none'}}>
            <option value="recent">Most Recent Sale</option>
            <option value="profit">Highest Profit</option>
            <option value="fastest">Fastest Sale</option>
          </select>
        </div>

        {/* Sold items list */}
        {sold.length === 0 ? (
          <div style={{textAlign:'center',padding:'48px 24px'}}>
            <p style={{fontSize:48,marginBottom:12}}>üí∞</p>
            <p style={{fontSize:16,fontWeight:600,color:'#fff',marginBottom:6}}>{soldItems.length === 0 ? 'No sold items yet' : 'No matches found'}</p>
            <p className="text-muted" style={{fontSize:13,lineHeight:1.5}}>{soldItems.length === 0 ? 'Enter earnings on any item to mark it as sold and track your velocity.' : 'Try a different search or filter.'}</p>
          </div>
        ) : (
          <div style={{display:'flex',flexDirection:'column',gap:10}}>
            {sold.map((item,i) => {
              const profit = item.earnings - item.cost;
              const days = getDaysToSell(item);
              return (
                <div key={item.id} onClick={() => goItem(item.id)} className="glass glass-hover anim-right" style={{borderRadius:14,padding:16,cursor:'pointer',animationDelay:`${i*0.04}s`}}>
                  <div style={{display:'flex',alignItems:'center',gap:14}}>
                    <div style={{width:48,height:48,borderRadius:12,background:'linear-gradient(135deg,#334155,#1e293b)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:24,flexShrink:0}}>{item.emoji}</div>
                    <div style={{flex:1,minWidth:0}}>
                      <p className="truncate" style={{fontWeight:600,color:'#fff',fontSize:14}}>{item.name}</p>
                      <div style={{display:'flex',alignItems:'center',gap:8,marginTop:4}}>
                        <span className="text-dim" style={{fontSize:11}}>Cost: {fmt(item.cost)}</span>
                        <span style={{color:'#475569'}}>‚Üí</span>
                        <span style={{fontSize:11,color:'#22c55e',fontWeight:600}}>Sold: {fmt(item.earnings)}</span>
                      </div>
                    </div>
                    <div style={{textAlign:'right',flexShrink:0}}>
                      <p style={{fontWeight:700,fontSize:14,color:profit>=0?'#4ade80':'#f87171'}}>{profit>=0?'+':''}${Math.abs(profit).toLocaleString()}</p>
                      <p className="text-dim" style={{fontSize:11,marginTop:3}}>{days !== '--' ? `${days}d` : '--'}</p>
                    </div>
                  </div>
                  {item.dateSold && <p className="text-dim" style={{fontSize:10,marginTop:8}}>Sold {new Date(item.dateSold).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}</p>}
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
    );
  };

  const AlertsScreen = () => {
    const alertColors = {'Below Cost':'#f87171','Underpriced':'#fbbf24','Priced High':'#f97316','Needs Comps':'#3b82f6','Set Market Value':'#8b5cf6','Strong Performer':'#4ade80','New Item Added':'#d4a853'};
    return (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      <div style={{padding:'20px 24px'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:20}}>
          <h1 style={{fontSize:24,fontWeight:700,color:'#fff'}}>Alerts</h1>
          {alerts.length > 0 && <span style={{background:'rgba(212,168,83,0.15)',color:'#d4a853',fontSize:12,fontWeight:700,padding:'4px 10px',borderRadius:20}}>{alerts.length}</span>}
        </div>
        {alerts.length === 0 ? (
          <div style={{textAlign:'center',padding:'60px 24px'}}>
            <p style={{fontSize:48,marginBottom:12}}>üîî</p>
            <p style={{fontSize:16,fontWeight:600,color:'#fff',marginBottom:6}}>No alerts yet</p>
            <p className="text-muted" style={{fontSize:13,lineHeight:1.5}}>Add items to your inventory and alerts will appear here based on your pricing, market values, and comparables.</p>
          </div>
        ) : (
        <div style={{display:'flex',flexDirection:'column',gap:10}}>
          {alerts.map((a,i) => {
            const Ic = Icons[a.iconKey] || Icons.Bell;
            const accentColor = alertColors[a.type] || '#d4a853';
            return (
              <div key={a.id} onClick={() => { if(a.itemId) { setSelectedId(a.itemId); setScreen('detail'); }}} className="glass glass-hover anim-right" style={{borderRadius:14,padding:16,cursor:'pointer',animationDelay:`${i*0.05}s`,borderLeft:`3px solid ${accentColor}`}}>
                <div style={{display:'flex',alignItems:'flex-start',gap:14}}>
                  <div style={{width:40,height:40,borderRadius:10,background:`${accentColor}18`,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,fontSize:20}}>{a.emoji||'üì¶'}</div>
                  <div style={{flex:1}}>
                    <div style={{display:'flex',alignItems:'center',gap:8}}>
                      <span style={{fontSize:10,fontWeight:700,textTransform:'uppercase',letterSpacing:0.5,color:accentColor,background:`${accentColor}15`,padding:'2px 8px',borderRadius:6}}>{a.type}</span>
                    </div>
                    <p style={{fontWeight:500,color:'#e2e8f0',fontSize:13,marginTop:6,lineHeight:1.4}}>{a.msg}</p>
                  </div>
                  <Icons.ChevronRight size={16} color={accentColor} style={{flexShrink:0,marginTop:2}}/>
                </div>
              </div>
            );
          })}
        </div>
        )}
      </div>
    </div>
  );
  };

  const ProfileScreen = () => (
    <div className="scroll-hide" style={{height:'100%',overflowY:'auto',paddingBottom:100}}>
      <div style={{padding:'20px 24px'}}>
        <h1 style={{fontSize:24,fontWeight:700,color:'#fff',marginBottom:20}}>Profile</h1>

        {/* User card */}
        <div className="glass" style={{borderRadius:16,padding:24,textAlign:'center',marginBottom:20}}>
          <div className="gradient-amber" style={{width:72,height:72,borderRadius:36,display:'flex',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:700,color:'#000',margin:'0 auto 14px'}}>{userInitial}</div>
          <h2 style={{fontSize:22,fontWeight:700,color:'#fff'}}>{userName}</h2>
          <p className="text-muted" style={{fontSize:13,marginTop:6}}>{userEmail}</p>
          <button onClick={() => setEditingProfile(true)} style={{background:'none',border:'none',color:'#d4a853',fontSize:13,fontWeight:600,cursor:'pointer',marginTop:8}}>Edit Profile</button>
        </div>

        {/* Stats */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginBottom:20}}>
          {[['Member Since', profile?.createdAt ? new Date(profile.createdAt).toLocaleDateString('en-US',{month:'short',year:'numeric'}) : '--'],['Items Tracked',String(items.length)],['Total Value',fmt(totalValue)],['Avg Value',fmt(avgValue)]].map(([k,v],i) => (
            <div key={i} className="glass" style={{borderRadius:12,padding:14,textAlign:'center'}}>
              <p className="text-dim" style={{fontSize:10,textTransform:'uppercase',letterSpacing:1}}>{k}</p>
              <p style={{fontSize:18,fontWeight:700,color:'#fff',marginTop:6}}>{v}</p>
            </div>
          ))}
        </div>

        {/* Data Management */}
        <div style={{display:'flex',flexDirection:'column',gap:8,marginBottom:20}}>
          <button onClick={() => {
            const data = { profile, items, exportedAt: new Date().toISOString(), version: '1.0' };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `item2value-backup-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }} className="glass glass-hover" style={{width:'100%',borderRadius:12,padding:'14px 16px',display:'flex',alignItems:'center',justifyContent:'space-between',cursor:'pointer',border:'1px solid rgba(255,255,255,0.08)',background:'rgba(255,255,255,0.04)'}}>
            <div style={{display:'flex',alignItems:'center',gap:12}}>
              <Icons.Download size={18} color="#4ade80"/>
              <div>
                <span style={{fontWeight:600,color:'#fff',fontSize:14,display:'block'}}>Export Backup</span>
                <span className="text-dim" style={{fontSize:11}}>Download all your data as a file</span>
              </div>
            </div>
            <Icons.ChevronRight size={18} color="#475569"/>
          </button>

          <label className="glass glass-hover" style={{width:'100%',borderRadius:12,padding:'14px 16px',display:'flex',alignItems:'center',justifyContent:'space-between',cursor:'pointer',border:'1px solid rgba(255,255,255,0.08)',background:'rgba(255,255,255,0.04)'}}>
            <div style={{display:'flex',alignItems:'center',gap:12}}>
              <Icons.Upload size={18} color="#3b82f6"/>
              <div>
                <span style={{fontWeight:600,color:'#fff',fontSize:14,display:'block'}}>Import Backup</span>
                <span className="text-dim" style={{fontSize:11}}>Restore from a backup file</span>
              </div>
            </div>
            <Icons.ChevronRight size={18} color="#475569"/>
            <input type="file" accept=".json" style={{display:'none'}} onChange={e => {
              const file = e.target.files[0];
              if (!file) return;
              const reader = new FileReader();
              reader.onload = (ev) => {
                try {
                  const data = JSON.parse(ev.target.result);
                  if (!data.items || !Array.isArray(data.items)) { alert('Invalid backup file.'); return; }
                  const count = data.items.length;
                  if (confirm(`This backup contains ${count} item${count!==1?'s':''}. Import will replace all current data. Continue?`)) {
                    if (data.profile) setProfile(data.profile);
                    setItems(data.items);
                    alert('Backup restored successfully!');
                  }
                } catch(err) { alert('Could not read backup file. Make sure it is a valid item2value export.'); }
              };
              reader.readAsText(file);
              e.target.value = '';
            }}/>
          </label>
        </div>

        {/* Settings */}
        <div style={{display:'flex',flexDirection:'column',gap:8,marginBottom:20}}>
          {[['Bell','Notification Preferences'],['Dollar','Default Currency'],['Shield','Privacy & Security'],['Help','Help & Support']].map(([ic,label],i) => {
            const Ic = Icons[ic];
            return (
              <button key={i} onClick={() => alert(label + ' is coming soon!')} className="glass" style={{width:'100%',borderRadius:12,padding:'14px 16px',display:'flex',alignItems:'center',justifyContent:'space-between',cursor:'pointer',border:'1px solid rgba(255,255,255,0.06)',background:'rgba(255,255,255,0.02)',opacity:0.6}}>
                <div style={{display:'flex',alignItems:'center',gap:12}}>
                  <Ic size={18} color="#64748b"/>
                  <span style={{fontWeight:600,color:'#94a3b8',fontSize:14}}>{label}</span>
                </div>
                <span style={{fontSize:9,background:'rgba(212,168,83,0.12)',color:'#d4a853',padding:'2px 6px',borderRadius:4,fontWeight:700}}>SOON</span>
              </button>
            );
          })}
        </div>

        {/* Danger zone */}
        <div style={{display:'flex',flexDirection:'column',gap:8,marginBottom:20}}>
          <button onClick={() => setShowClearConfirm(true)} className="glass glass-hover" style={{width:'100%',borderRadius:12,padding:'14px 16px',display:'flex',alignItems:'center',justifyContent:'space-between',cursor:'pointer',border:'1px solid rgba(239,68,68,0.15)',background:'rgba(239,68,68,0.06)'}}>
            <div style={{display:'flex',alignItems:'center',gap:12}}>
              <Icons.Trash2 size={18} color="#f87171"/>
              <span style={{fontWeight:600,color:'#f87171',fontSize:14}}>Clear All Items</span>
            </div>
            <Icons.ChevronRight size={18} color="#475569"/>
          </button>
        </div>

        <button onClick={() => {
          if (confirm('Sign out? This will clear your profile but your inventory data stays on this device. You can sign back in by entering your name and email.')) {
            localStorage.removeItem('item2value_profile');
            setProfile(null);
            setScreen('setup');
          }
        }} style={{width:'100%',background:'rgba(255,255,255,0.03)',border:'1px solid rgba(239,68,68,0.2)',borderRadius:12,padding:'14px 0',color:'#f87171',fontSize:15,fontWeight:600,cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:8}}>
          <Icons.LogOut size={16} color="#f87171"/>Sign Out
        </button>
      </div>

      {/* Edit Profile Modal */}
      {editingProfile && (
        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.7)',backdropFilter:'blur(8px)',zIndex:100,display:'flex',alignItems:'center',justifyContent:'center',padding:24}} onClick={() => setEditingProfile(false)}>
          <div onClick={e => e.stopPropagation()} style={{background:'#1a1a2e',border:'1px solid rgba(255,255,255,0.12)',borderRadius:20,padding:28,maxWidth:340,width:'100%'}}>
            <h3 style={{fontSize:18,fontWeight:700,color:'#fff',marginBottom:20,textAlign:'center'}}>Edit Profile</h3>
            <FormField label="Name" required>
              <input ref={profileNameRef} className="form-input" defaultValue={userName} style={inputStyle}/>
            </FormField>
            <FormField label="Email" required>
              <input ref={profileEmailRef} className="form-input" type="email" defaultValue={userEmail} style={inputStyle}/>
            </FormField>
            <div style={{display:'flex',gap:10,marginTop:8}}>
              <button onClick={() => setEditingProfile(false)} style={{flex:1,padding:'12px 0',borderRadius:12,border:'1px solid rgba(255,255,255,0.15)',background:'rgba(255,255,255,0.06)',color:'#fff',fontSize:14,fontWeight:600,cursor:'pointer'}}>Cancel</button>
              <button onClick={() => {
                const name = profileNameRef.current?.value?.trim() || '';
                const email = profileEmailRef.current?.value?.trim() || '';
                if (!name) { alert('Please enter your name.'); return; }
                if (!email) { alert('Please enter your email.'); return; }
                setProfile(prev => ({...prev, name, email}));
                setEditingProfile(false);
              }} className="gradient-amber" style={{flex:1,padding:'12px 0',borderRadius:12,border:'none',fontSize:14,fontWeight:700,color:'#000',cursor:'pointer'}}>Save</button>
            </div>
          </div>
        </div>
      )}

      {/* Clear All Confirmation Modal */}
      {showClearConfirm && (
        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.7)',backdropFilter:'blur(8px)',zIndex:100,display:'flex',alignItems:'center',justifyContent:'center',padding:24}} onClick={() => setShowClearConfirm(false)}>
          <div onClick={e => e.stopPropagation()} style={{background:'#1a1a2e',border:'1px solid rgba(255,255,255,0.12)',borderRadius:20,padding:28,maxWidth:340,width:'100%',textAlign:'center'}}>
            <div style={{width:56,height:56,borderRadius:28,background:'rgba(239,68,68,0.15)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 16px'}}>
              <Icons.AlertTriangle size={28} color="#f87171"/>
            </div>
            <h3 style={{fontSize:18,fontWeight:700,color:'#fff',marginBottom:8}}>Clear All Items?</h3>
            <p style={{fontSize:14,color:'#94a3b8',lineHeight:1.5,marginBottom:24}}>This will permanently delete all items in your inventory. This action cannot be undone.</p>
            <div style={{display:'flex',gap:10}}>
              <button onClick={() => setShowClearConfirm(false)} style={{flex:1,padding:'12px 0',borderRadius:12,border:'1px solid rgba(255,255,255,0.15)',background:'rgba(255,255,255,0.06)',color:'#fff',fontSize:14,fontWeight:600,cursor:'pointer'}}>Cancel</button>
              <button onClick={() => { setItems([]); localStorage.removeItem('item2value_items'); setShowClearConfirm(false); }} style={{flex:1,padding:'12px 0',borderRadius:12,border:'none',background:'#ef4444',color:'#fff',fontSize:14,fontWeight:700,cursor:'pointer'}}>Yes, Delete All</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const renderScreen = () => {
    switch(screen) {
      case 'setup': return SetupScreen();
      case 'home': return HomeScreen();
      case 'scan': return ScanScreen();
      case 'ai': return AIScreen();
      case 'add-item': return AddItemScreen();
      case 'inventory': return InventoryScreen();
      case 'detail': return DetailScreen();
      case 'edit-item': return EditItemScreen();
      case 'pricing': return PricingScreen();
      case 'sold-items': return SoldItemsScreen();
      case 'alerts': return AlertsScreen();
      case 'profile': return ProfileScreen();
      default: return HomeScreen();
    }
  };

  // After camera scan animation, go to AI screen
  useEffect(() => {
    if (analyzing || aiDone) setScreen('ai');
  }, [analyzing, aiDone]);

  const showTabs = !['scan','add-item','edit-item','setup'].includes(screen);
  const tabs = [
    {id:'home',icon:'Home',label:'Home'},
    {id:'inventory',icon:'Package',label:'Inventory'},
    {id:'scan',icon:'Camera',label:'Scan',primary:true},
    {id:'alerts',icon:'Bell',label:'Alerts'},
    {id:'profile',icon:'User',label:'Profile'},
  ];

  return (
    <div style={{width:'100%',height:'100vh',display:'flex',justifyContent:'center',background:'#06060b'}}>
      <div style={{width:'100%',maxWidth:390,height:'100%',position:'relative',overflow:'hidden',background:'linear-gradient(180deg,#0a0a0f,#0d0d14,#0a0a0f)'}}>
        {renderScreen()}

        {/* Tab Bar */}
        {showTabs && (
          <div style={{position:'absolute',bottom:0,left:0,right:0,background:'linear-gradient(to top,#0a0a0f 70%,transparent)',borderTop:'1px solid rgba(255,255,255,0.06)',padding:'8px 12px 16px',zIndex:30}}>
            <div style={{display:'flex',justifyContent:'space-around',alignItems:'center'}}>
              {tabs.map(tab => {
                const Ic = Icons[tab.icon];
                const active = screen === tab.id || (tab.id === 'home' && ['home','sold-items'].includes(screen)) || (tab.id === 'inventory' && ['inventory','detail','edit-item','pricing'].includes(screen));
                return (
                  <button key={tab.id} onClick={() => {
                    if (tab.id === 'scan') { setScanning(false); setAnalyzing(false); setAiDone(false); }
                    setScreen(tab.id);
                  }} style={{display:'flex',flexDirection:'column',alignItems:'center',gap:4,background:'none',border:'none',cursor:'pointer',padding:'6px 12px',borderRadius:10}}>
                    <div style={{padding:6,borderRadius:8,background: active?'rgba(212,168,83,0.15)':'transparent',position:'relative'}}>
                      <Ic size={20} color={active?'#d4a853':'#475569'}/>
                      {tab.id === 'alerts' && alerts.length > 0 && <div style={{position:'absolute',top:4,right:4,width:8,height:8,borderRadius:4,background:'#f87171',border:'2px solid #0a0a0f'}}/>}
                    </div>
                    <span style={{fontSize:10,fontWeight:600,color: active?'#d4a853':'#475569'}}>{tab.label}</span>
                  </button>
                );
              })}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
